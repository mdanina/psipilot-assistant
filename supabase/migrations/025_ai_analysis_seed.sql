-- PsiPilot Assistant - AI Analysis Seed Data
-- Migration: 025_ai_analysis_seed
-- Description: Insert system block templates and note template for Initial Psychiatric Assessment

-- ============================================
-- SYSTEM BLOCK TEMPLATES
-- ============================================
-- Insert 11 system blocks for Initial Psychiatric Assessment

-- 1. Причина обращения
INSERT INTO note_block_templates (
  id, clinic_id, name, name_en, slug, description, category, system_prompt, is_system, position
) VALUES (
  gen_random_uuid(),
  NULL,
  'Причина обращения',
  'Contact Reason',
  'contact_reason',
  'Основная причина, по которой пациент обратился за помощью',
  'assessment',
  'Ты — опытный психиатр. На основе транскрипта сессии сформулируй причину обращения пациента.
Напиши 2-4 предложения, описывающие:
- Почему пациент обратился за помощью
- Основные жалобы
- Как долго существует проблема
- Что послужило триггером обращения

Пиши от третьего лица ("Пациент обратился...", "Пациент сообщает...").
Используй профессиональный медицинский язык, но избегай излишнего жаргона.',
  true,
  1
);

-- 2. История настоящего заболевания
INSERT INTO note_block_templates (
  id, clinic_id, name, name_en, slug, description, category, system_prompt, is_system, position
) VALUES (
  gen_random_uuid(),
  NULL,
  'История настоящего заболевания',
  'History of Present Illness',
  'history_present_illness',
  'Развитие текущих симптомов и их характеристики',
  'history',
  'Ты — опытный психиатр. На основе транскрипта сессии опиши историю настоящего заболевания.
Включи:
- Хронологию развития симптомов
- Характер и выраженность симптомов
- Провоцирующие и облегчающие факторы
- Влияние на повседневную жизнь
- Предыдущие попытки справиться с проблемой

Пиши структурированно, от третьего лица. Длина: 1-2 абзаца.',
  true,
  2
);

-- 3. Психиатрический анамнез
INSERT INTO note_block_templates (
  id, clinic_id, name, name_en, slug, description, category, system_prompt, is_system, position
) VALUES (
  gen_random_uuid(),
  NULL,
  'Психиатрический анамнез',
  'Past Psychiatric History',
  'past_psychiatric',
  'Предыдущие психические расстройства, госпитализации, лечение',
  'history',
  'Ты — опытный психиатр. На основе транскрипта сессии опиши психиатрический анамнез пациента.
Включи (если информация доступна):
- Предыдущие психиатрические диагнозы
- Госпитализации в психиатрические учреждения
- Предыдущее медикаментозное лечение (препараты, дозы, эффективность)
- Предыдущая психотерапия (тип, длительность, результат)
- Суицидальные попытки или самоповреждение в анамнезе

Если информация не упоминается, напиши "Информация не предоставлена" или "Отрицает".
Пиши от третьего лица.',
  true,
  3
);

-- 4. Соматический анамнез
INSERT INTO note_block_templates (
  id, clinic_id, name, name_en, slug, description, category, system_prompt, is_system, position
) VALUES (
  gen_random_uuid(),
  NULL,
  'Соматический анамнез',
  'Somatic History',
  'somatic_history',
  'Физическое здоровье, хронические заболевания, медикаменты',
  'history',
  'Ты — опытный психиатр. На основе транскрипта сессии опиши соматический анамнез пациента.
Включи:
- Хронические заболевания
- Текущие соматические жалобы
- Принимаемые медикаменты (не психиатрические)
- Аллергии
- Перенесённые операции и травмы

Если информация не упоминается, укажи "Информация не предоставлена".
Пиши кратко, от третьего лица.',
  true,
  4
);

-- 5. Употребление ПАВ
INSERT INTO note_block_templates (
  id, clinic_id, name, name_en, slug, description, category, system_prompt, is_system, position
) VALUES (
  gen_random_uuid(),
  NULL,
  'Употребление ПАВ',
  'Substance Use',
  'substance_use',
  'Алкоголь, наркотики, никотин, другие психоактивные вещества',
  'history',
  'Ты — опытный психиатр. На основе транскрипта сессии опиши историю употребления психоактивных веществ.
Включи:
- Алкоголь (частота, количество, паттерн употребления)
- Табак/никотин
- Наркотические вещества (какие, частота)
- Злоупотребление лекарствами
- Признаки зависимости или абстиненции

Если пациент отрицает употребление, укажи это явно.
Пиши от третьего лица, без осуждения.',
  true,
  5
);

-- 6. Семейный анамнез
INSERT INTO note_block_templates (
  id, clinic_id, name, name_en, slug, description, category, system_prompt, is_system, position
) VALUES (
  gen_random_uuid(),
  NULL,
  'Семейный анамнез',
  'Family History',
  'family_history',
  'Психические заболевания в семье, наследственность',
  'history',
  'Ты — опытный психиатр. На основе транскрипта сессии опиши семейный психиатрический анамнез.
Включи:
- Психические расстройства у родственников первой линии (родители, братья/сёстры, дети)
- Психические расстройства у родственников второй линии
- Суициды в семье
- Злоупотребление ПАВ в семье

Если информация не упоминается, напиши "Информация не предоставлена".
Пиши от третьего лица.',
  true,
  6
);

-- 7. Социальный анамнез
INSERT INTO note_block_templates (
  id, clinic_id, name, name_en, slug, description, category, system_prompt, is_system, position
) VALUES (
  gen_random_uuid(),
  NULL,
  'Социальный анамнез',
  'Social History',
  'social_history',
  'Образование, работа, отношения, условия жизни',
  'history',
  'Ты — опытный психиатр. На основе транскрипта сессии опиши социальный анамнез пациента.
Включи:
- Образование
- Текущая занятость / профессия
- Семейное положение и отношения
- Дети
- Условия проживания
- Социальная поддержка
- Значимые жизненные события

Пиши от третьего лица, структурированно.',
  true,
  7
);

-- 8. Текущая терапия
INSERT INTO note_block_templates (
  id, clinic_id, name, name_en, slug, description, category, system_prompt, is_system, position
) VALUES (
  gen_random_uuid(),
  NULL,
  'Текущая терапия',
  'Current Treatment',
  'current_treatment',
  'Текущие препараты и психотерапия',
  'treatment',
  'Ты — опытный психиатр. На основе транскрипта сессии опиши текущее лечение пациента.
Включи:
- Текущие психиатрические препараты (названия, дозы, длительность приёма)
- Текущая психотерапия (тип, частота, терапевт)
- Эффективность текущего лечения
- Побочные эффекты
- Комплаентность

Если пациент не получает лечения, укажи это.
Пиши от третьего лица.',
  true,
  8
);

-- 9. Психический статус
INSERT INTO note_block_templates (
  id, clinic_id, name, name_en, slug, description, category, system_prompt, is_system, position
) VALUES (
  gen_random_uuid(),
  NULL,
  'Психический статус',
  'Mental Status Examination',
  'mental_status',
  'Оценка психического состояния на момент осмотра (MSE)',
  'status',
  'Ты — опытный психиатр. На основе транскрипта сессии опиши психический статус пациента (MSE).
Структура:
- Внешний вид и поведение
- Речь (темп, громкость, связность)
- Настроение (со слов пациента) и аффект (наблюдаемый)
- Мышление (форма и содержание)
- Восприятие (галлюцинации, иллюзии)
- Когнитивные функции (ориентация, внимание, память)
- Инсайт и критика

Используй стандартную психиатрическую терминологию.
Пиши от третьего лица.',
  true,
  9
);

-- 10. Оценка рисков
INSERT INTO note_block_templates (
  id, clinic_id, name, name_en, slug, description, category, system_prompt, is_system, position
) VALUES (
  gen_random_uuid(),
  NULL,
  'Оценка рисков',
  'Risk Assessment',
  'risk_assessment',
  'Оценка суицидального риска, риска самоповреждения и агрессии',
  'status',
  'Ты — опытный психиатр. На основе транскрипта сессии проведи оценку рисков.
Оцени:

1. Суицидальный риск:
   - Суицидальные мысли (пассивные/активные)
   - Планы и намерения
   - Доступ к средствам
   - Защитные факторы

2. Риск самоповреждения:
   - Текущее самоповреждение
   - История самоповреждения

3. Риск для других:
   - Агрессивные мысли или поведение
   - История насилия

Заверши общей оценкой уровня риска (низкий/умеренный/высокий) с обоснованием.
Пиши от третьего лица, чётко и структурированно.',
  true,
  10
);

-- 11. Заключение и план
INSERT INTO note_block_templates (
  id, clinic_id, name, name_en, slug, description, category, system_prompt, is_system, position
) VALUES (
  gen_random_uuid(),
  NULL,
  'Заключение и план',
  'Conclusion and Plan',
  'conclusion_plan',
  'Диагностическое впечатление и план лечения',
  'conclusion',
  'Ты — опытный психиатр. На основе транскрипта сессии сформулируй заключение и план.

1. Диагностическое впечатление:
   - Предварительный диагноз (или дифференциальный)
   - Обоснование

2. План лечения:
   - Медикаментозная терапия (если показана)
   - Психотерапия (тип, частота)
   - Дополнительные обследования
   - Направления к другим специалистам

3. План безопасности (если есть риски)

4. Следующий приём

Пиши профессионально, от третьего лица.',
  true,
  11
);

-- ============================================
-- SYSTEM NOTE TEMPLATE
-- ============================================
-- Create system template that includes all 11 blocks in order

INSERT INTO clinical_note_templates (
  id, clinic_id, name, name_en, description, block_template_ids, is_default, is_system
) VALUES (
  gen_random_uuid(),
  NULL,
  'Первичная психиатрическая оценка',
  'Initial Psychiatric Assessment',
  'Полная первичная оценка для новых пациентов',
  (SELECT ARRAY_AGG(id ORDER BY position) FROM note_block_templates WHERE is_system = true),
  true,
  true
);
