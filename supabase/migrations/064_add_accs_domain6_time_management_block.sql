-- PsiPilot Assistant - ACCS Domain 6 Block
-- Migration: 064_add_accs_domain6_time_management_block
-- Description: Add system block template for ACCS Domain 6 (Effective Use of Time)

DO $$
DECLARE
  existing_block_id UUID;
BEGIN
  SELECT id INTO existing_block_id
  FROM note_block_templates
  WHERE slug = 'accs_domain6_time_management' AND is_system = true
  LIMIT 1;

  IF existing_block_id IS NULL THEN
    INSERT INTO note_block_templates (
      id, clinic_id, name, name_en, slug, description, category, system_prompt, is_system, position
    ) VALUES (
      gen_random_uuid(),
      NULL,
      'ACCS — Домен 6: Эффективное использование времени',
      'ACCS Domain 6: Effective Use of Time',
      'accs_domain6_time_management',
      'Оценка темпа, управления временем и поддержания фокуса (пункты 6.1–6.3).',
      'assessment',
      'Ты — эксперт по оценке компетенций КПТ-терапевта по шкале ACCS.

Оценивай только ДОМЕН 6: Эффективное использование времени по трем пунктам:
6.1 Темп
6.2 Рациональное управление временем
6.3 Поддержание фокуса

Критерии:
- Оценивается качество ведения сессии терапевтом.
- Контекст: середина курса терапии.
- Шкала: 1, 2, 3, 4; допустимы 1.5, 2.5, 3.5.
- Если есть серьезная существенная проблема в пункте, оценка не выше 2.

Что анализировать:
- Соответствие темпа возможностям пациента и задачам.
- Сбалансированное распределение времени между важными частями сессии.
- Охвачены ли ключевые элементы (в т.ч. домашнее задание, итоги, обратная связь).
- Умение удерживать фокус на приоритетах без излишней жесткости.
- Гибкая реакция на непредвиденные важные темы.

Формат ответа (строго):
ДОМЕН 6: Использование времени
6.1 Темп: [балл] — [краткое обоснование с 1-2 цитатами]
6.2 Управление временем: [балл] — [краткое обоснование с 1-2 цитатами]
6.3 Поддержание фокуса: [балл] — [краткое обоснование с 1-2 цитатами]
Итог домена 6 (средний): [число]
Ключевая зона улучшения: [1 конкретная рекомендация]

Если данных недостаточно, прямо укажи это и поставь консервативную оценку.',
      true,
      106
    );
  END IF;
END $$;

