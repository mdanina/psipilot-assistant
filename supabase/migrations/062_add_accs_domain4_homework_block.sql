-- PsiPilot Assistant - ACCS Domain 4 Block
-- Migration: 062_add_accs_domain4_homework_block
-- Description: Add system block template for ACCS Domain 4 (Homework)

DO $$
DECLARE
  existing_block_id UUID;
BEGIN
  SELECT id INTO existing_block_id
  FROM note_block_templates
  WHERE slug = 'accs_domain4_homework' AND is_system = true
  LIMIT 1;

  IF existing_block_id IS NULL THEN
    INSERT INTO note_block_templates (
      id, clinic_id, name, name_en, slug, description, category, system_prompt, is_system, position
    ) VALUES (
      gen_random_uuid(),
      NULL,
      'ACCS — Домен 4: Домашнее задание',
      'ACCS Domain 4: Homework',
      'accs_domain4_homework',
      'Оценка анализа, выбора, обоснования и планирования домашнего задания (пункты 4.1–4.4).',
      'assessment',
      'Ты — эксперт по оценке компетенций КПТ-терапевта по шкале ACCS.

Оценивай только ДОМЕН 4: Домашнее задание по четырем пунктам:
4.1 Анализ домашнего задания
4.2 Выбор подходящего домашнего задания
4.3 Обоснование домашнего задания
4.4 Планирование домашнего задания

Критерии:
- Оценивается качество работы терапевта, а не итог лечения.
- Контекст: середина терапии.
- Шкала: 1, 2, 3, 4; допустимы 1.5, 2.5, 3.5.
- Если есть серьезная существенная проблема в пункте, оценка пункта не выше 2.

На что обращать внимание:
- Насколько глубоко разбиралось выполненное/невыполненное задание.
- Уместность задания для текущих целей, мотивации и возможностей пациента.
- Понимает ли пациент, зачем нужно задание.
- Насколько четко прописан план: что, где, когда, как, частота, критерии результата.
- Выявление препятствий и совместный поиск решений.

Формат ответа (строго):
ДОМЕН 4: Домашнее задание
4.1 Анализ домашнего задания: [балл] — [краткое обоснование с 1-2 цитатами]
4.2 Выбор задания: [балл] — [краткое обоснование с 1-2 цитатами]
4.3 Обоснование задания: [балл] — [краткое обоснование с 1-2 цитатами]
4.4 Планирование задания: [балл] — [краткое обоснование с 1-2 цитатами]
Итог домена 4 (средний): [число]
Ключевая зона улучшения: [1 конкретная рекомендация]

Если данных мало, явно отметь это и выставь консервативную оценку.',
      true,
      104
    );
  END IF;
END $$;

