# –ü–æ—á–µ–º—É IndexedDB –ø—É—Å—Ç–æ–π –∏ –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

## –ü–æ—á–µ–º—É IndexedDB –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º

IndexedDB –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö `psipilot-recordings` —Å–æ–∑–¥–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏**. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ, –∞ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ–Ω–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–∞.

## –ö–æ–≥–¥–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–µ—Ç—Å—è

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ `saveRecordingLocally()`, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:

1. **–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∑–∞–ø–∏—Å–∏** (`/`) - –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞—Ç—å" –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏
2. **–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–µ—Å—Å–∏–π** (`/sessions`) - –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –∑–∞–ø–∏—Å–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Å–µ—Å—Å–∏–∏

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–ø–∏—Å–∏ (`/`) –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å–µ—Å—Å–∏—é –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–µ—Å—Å–∏–π
2. –ù–∞–∂–º–∏—Ç–µ "–í–∫–ª—é—á–∏—Ç—å –∑–∞–ø–∏—Å—å" (–∏–∫–æ–Ω–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞)
3. –ó–∞–ø–∏—à–∏—Ç–µ –∫–æ—Ä–æ—Ç–∫–æ–µ –∞—É–¥–∏–æ (10-20 —Å–µ–∫—É–Ω–¥)
4. –ù–∞–∂–º–∏—Ç–µ "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å" (–∫–≤–∞–¥—Ä–∞—Ç–Ω–∞—è –∫–Ω–æ–ø–∫–∞)
5. –ù–∞–∂–º–∏—Ç–µ "–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞—Ç—å" (–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∑–∞–ø–∏—Å–∏) –∏–ª–∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–µ—Å—Å–∏–π)

**–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ:**
- –í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è: `[LocalStorage] IndexedDB opened successfully` –∏–ª–∏ `[LocalStorage] IndexedDB upgrade needed, creating database`
- –í DevTools ‚Üí Application ‚Üí IndexedDB –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –±–∞–∑–∞ `psipilot-recordings`
- –í –±–∞–∑–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `recordings`

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å

–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å IndexedDB
console.log('IndexedDB available:', typeof indexedDB !== 'undefined');

// –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç—å –±–∞–∑—É (—Å–æ–∑–¥–∞—Å—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
const request = indexedDB.open('psipilot-recordings', 1);
request.onsuccess = () => {
  console.log('‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç–∫—Ä—ã—Ç–∞/—Å–æ–∑–¥–∞–Ω–∞');
  const db = request.result;
  console.log('Object stores:', Array.from(db.objectStoreNames));
};
request.onerror = () => {
  console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –±–∞–∑—ã:', request.error);
};
request.onupgradeneeded = () => {
  console.log('üîÑ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (—Å–æ–∑–¥–∞–µ—Ç—Å—è)');
};
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Web Crypto API

–õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç Web Crypto API. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏:

```javascript
console.log('Web Crypto API available:', 
  typeof crypto !== 'undefined' && 
  typeof crypto.subtle !== 'undefined'
);
```

**–í–∞–∂–Ω–æ:** Web Crypto API —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ HTTPS –∏–ª–∏ localhost. –ù–∞ –æ–±—ã—á–Ω–æ–º HTTP –æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

## –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ DevTools

### 1. Application ‚Üí IndexedDB

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è:
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** `psipilot-recordings`
- **–í–µ—Ä—Å–∏—è:** `1`
- **Object Store:** `recordings`
- **–ò–Ω–¥–µ–∫—Å—ã:** `createdAt`, `uploaded`, `expiresAt`

### 2. Application ‚Üí Session Storage

–î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–ª—é—á:
- `recording_session_key` - –º–∞—Å—Å–∏–≤ —á–∏—Å–µ–ª (–∫–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è)

### 3. Console

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏:
- `[LocalStorage] IndexedDB opened successfully`
- `[LocalStorage] Recording saved locally: local-...`
- `[ScribePage] Recording saved locally: local-...` –∏–ª–∏ `[SessionsPage] Recording saved locally: local-...`

## –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: IndexedDB –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –ó–∞–ø–∏—Å—å –µ—â–µ –Ω–µ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –±–∞–∑–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
2. IndexedDB –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –±—Ä–∞—É–∑–µ—Ä–æ–º (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è)
3. –ö–≤–æ—Ç–∞ –±—Ä–∞—É–∑–µ—Ä–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞–ø–∏—Å—å
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ –ª–∏ –≤—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏

### –ü—Ä–æ–±–ª–µ–º–∞: "Web Crypto API is not available"

**–ü—Ä–∏—á–∏–Ω–∞:** Web Crypto API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ HTTP (—Ç–æ–ª—å–∫–æ –Ω–∞ HTTPS –∏–ª–∏ localhost)

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `localhost` –∏–ª–∏ HTTPS
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏: `typeof crypto !== 'undefined'`

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∑–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è, –Ω–æ –∑–∞–ø–∏—Å–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. –ö–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
2. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å sessionStorage (–∫–ª—é—á `recording_session_key`)
3. –†–∞–∑–º–µ—Ä –∑–∞–ø–∏—Å–∏ (–º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å –∫–≤–æ—Ç—É)

## –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:

```javascript
(async () => {
  try {
    // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –æ–Ω–∏ —É–∂–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã)
    const { isIndexedDBAvailable } = await import('/src/lib/local-recording-storage.ts');
    const available = await isIndexedDBAvailable();
    console.log('IndexedDB –¥–æ—Å—Ç—É–ø–µ–Ω:', available);
    
    if (available) {
      console.log('‚úÖ –í—Å–µ –≥–æ—Ç–æ–≤–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
    } else {
      console.warn('‚ö†Ô∏è IndexedDB –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
    }
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:', error);
  }
})();
```

## –í—ã–≤–æ–¥

**IndexedDB –ø—É—Å—Ç–æ–π - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ**, –µ—Å–ª–∏ –≤—ã –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª–∏ –∑–∞–ø–∏—Å–∏. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏. 

–ß—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
1. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–ø–∏—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∑–∞–ø–∏—Å–∏ –∏–ª–∏ –≤ —Å–µ—Å—Å–∏–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–∞–∑–∞ –ø–æ—è–≤–∏–ª–∞—Å—å –≤ DevTools
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –ª–æ–≥–∏ —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑—ã

