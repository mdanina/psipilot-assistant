# Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ: AI-Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· ÑĞµÑÑĞ¸Ğ¹

**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.0
**Ğ”Ğ°Ñ‚Ğ°:** 2025-12-08
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** Ğ¡Ğ¾Ğ³Ğ»Ğ°ÑĞ¾Ğ²Ğ°Ğ½Ğ¾

---

## 1. ĞĞ±Ğ·Ğ¾Ñ€

### 1.1 Ğ¦ĞµĞ»ÑŒ

Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ AI-Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ñ‚ĞµÑ€Ğ°Ğ¿ĞµĞ²Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… ÑĞµÑÑĞ¸Ğ¹, ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°Ñ:
- Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ² Ğ¸ Ğ·Ğ°Ğ¼ĞµÑ‚Ğ¾Ğº
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ğ±Ğ»Ğ¾ĞºĞ¾Ğ² (ÑĞµĞºÑ†Ğ¸Ğ¹) Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğ¼Ğ¸ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°Ğ¼Ğ¸
- Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ñ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¾Ğ¹ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ° Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ¸ ÑĞ²Ğ¾Ğ´ĞºĞ¸

### 1.2 Ğ ĞµÑ„ĞµÑ€ĞµĞ½Ñ

ĞŸÑ€Ğ¾Ğ´ÑƒĞºÑ‚-Ñ€ĞµÑ„ĞµÑ€ĞµĞ½Ñ: [Aisel](https://app.aisel.co) â€” Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ» Ğ´Ğ»Ñ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ¾Ñ†ĞµĞ½Ğ¾Ğº.

### 1.3 ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ

| ĞÑĞ¿ĞµĞºÑ‚ | Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ |
|--------|---------|
| AI Provider | OpenAI API (GPT-5) |
| API Key | Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ (Ğ¾Ğ´Ğ¸Ğ½ Ğ½Ğ° Ğ²ÑÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ) |
| Ğ›Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ | Ğ‘ĞµĞ· Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ¾Ğ² |
| Backend Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° | Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾ `transcription-service` |
| Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ AI-ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ° | Ğ”Ğ° (AES-GCM 256) |
| ĞĞ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ | Ğ”Ğ°, Ğ¿ĞµÑ€ĞµĞ´ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ğ¹ Ğ² OpenAI |
| Audit logging | Ğ”Ğ°, Ğ²ÑĞµ AI-Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ |
| Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ±ĞµĞ· Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ° | Ğ—Ğ°Ğ¿Ñ€ĞµÑ‰ĞµĞ½Ğ° |

---

## 2. ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### 2.1 ĞĞ±Ñ‰Ğ°Ñ ÑÑ…ĞµĞ¼Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Frontend (React)                            â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              SessionAnalysisPage                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  Patient Information â”‚  Clinical Notes Output        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Input               â”‚                               â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                      â”‚  [Template Selector â–¼]        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  [Transcript][Notes] â”‚                               â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                      â”‚  Sections:    â”‚ Content:      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â˜° Contact    â”‚ AI-generated  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Ğ¢Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚     â”‚  â”‚  â˜° History    â”‚ text with     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ° Ğ¸Ğ»Ğ¸    â”‚  â”‚  â˜° Assessment â”‚ ability to    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ğµ    â”‚  â”‚  ...          â”‚ edit          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸        â”‚  â”‚  [+ Add]      â”‚               â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚               â”‚               â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                      â”‚               â”‚    [Copy]     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  [ğŸ¤][ğŸ“„]            â”‚                               â”‚    â”‚   â”‚
â”‚  â”‚  â”‚       [âœ¨ Generate Summary]                          â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Backend (transcription-service)                  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ /api/transcribe â”‚  â”‚ /api/ai/*       â”‚  â”‚ /api/webhook       â”‚  â”‚
â”‚  â”‚ (AssemblyAI)    â”‚  â”‚ (OpenAI)        â”‚  â”‚ (callbacks)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    AI Processing Pipeline                     â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  1. ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (transcript + notes + patient)          â”‚  â”‚
â”‚  â”‚  2. ĞĞ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (patient data + regex patterns)             â”‚  â”‚
â”‚  â”‚  3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ mapping (encrypted)                           â”‚  â”‚
â”‚  â”‚  4. ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğº OpenAI (Ğ¿Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ°Ğ¼)               â”‚  â”‚
â”‚  â”‚  5. Ğ”Ğµ-Ğ°Ğ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²                                  â”‚  â”‚
â”‚  â”‚  6. Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°                       â”‚  â”‚
â”‚  â”‚  7. Audit logging                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼               â–¼               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Supabase   â”‚ â”‚  OpenAI     â”‚ â”‚  AssemblyAI â”‚
            â”‚  (PostgreSQL)â”‚ â”‚  API        â”‚ â”‚  API        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¸ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AI Generation Flow                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  1. Frontend: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ "Generate Summary"           â”‚
â”‚                          â”‚                                        â”‚
â”‚                          â–¼                                        â”‚
â”‚  2. Backend: ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚ + Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ ÑĞµÑÑĞ¸Ğ¸                â”‚
â”‚              ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ° (Ğ´Ğ»Ñ Ğ°Ğ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸)         â”‚
â”‚                          â”‚                                        â”‚
â”‚                          â–¼                                        â”‚
â”‚  3. ĞĞ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:                                                â”‚
â”‚     "ĞĞ½Ğ½Ğ°, 32 Ğ³Ğ¾Ğ´Ğ°" â†’ "[PATIENT_NAME], [AGE] Ğ»ĞµÑ‚"                â”‚
â”‚     Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ mapping: { "[PATIENT_NAME]": "ĞĞ½Ğ½Ğ°", ... }         â”‚
â”‚                          â”‚                                        â”‚
â”‚                          â–¼                                        â”‚
â”‚  4. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ clinical_note (status: 'generating')                 â”‚
â”‚     Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ sections Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ° (status: 'pending')       â”‚
â”‚                          â”‚                                        â”‚
â”‚                          â–¼                                        â”‚
â”‚  5. ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ°:                               â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚     â”‚  Block 1        Block 2        Block N      â”‚              â”‚
â”‚     â”‚     â”‚              â”‚              â”‚         â”‚              â”‚
â”‚     â”‚     â–¼              â–¼              â–¼         â”‚              â”‚
â”‚     â”‚  OpenAI         OpenAI         OpenAI       â”‚              â”‚
â”‚     â”‚     â”‚              â”‚              â”‚         â”‚              â”‚
â”‚     â”‚     â–¼              â–¼              â–¼         â”‚              â”‚
â”‚     â”‚  section 1     section 2     section N      â”‚              â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                          â”‚                                        â”‚
â”‚                          â–¼                                        â”‚
â”‚  6. Ğ”Ğµ-Ğ°Ğ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°                               â”‚
â”‚     "[PATIENT_NAME]" â†’ "ĞĞ½Ğ½Ğ°"                                    â”‚
â”‚                          â”‚                                        â”‚
â”‚                          â–¼                                        â”‚
â”‚  7. Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ° (AES-GCM 256)                            â”‚
â”‚     Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Ğ‘Ğ”                                              â”‚
â”‚                          â”‚                                        â”‚
â”‚                          â–¼                                        â”‚
â”‚  8. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ clinical_note (status: 'completed')                â”‚
â”‚     Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼ Ğ² audit_logs                                        â”‚
â”‚                          â”‚                                        â”‚
â”‚                          â–¼                                        â”‚
â”‚  9. Frontend: ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚                               â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### 3.1 ĞĞ¾Ğ²Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹

#### 3.1.1 `note_block_templates` â€” Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ² Ğ±Ğ»Ğ¾ĞºĞ¾Ğ²

```sql
CREATE TABLE note_block_templates (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  clinic_id UUID REFERENCES clinics(id) ON DELETE CASCADE,

  -- ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ
  name VARCHAR(100) NOT NULL,
  name_en VARCHAR(100),
  slug VARCHAR(50) NOT NULL,
  description TEXT,
  category VARCHAR(50) NOT NULL,

  -- AI Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
  system_prompt TEXT NOT NULL,

  -- Ğ¤Ğ»Ğ°Ğ³Ğ¸
  is_system BOOLEAN DEFAULT false,
  is_active BOOLEAN DEFAULT true,

  -- ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº
  position INTEGER DEFAULT 0,

  -- ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now(),

  -- ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ
  CONSTRAINT unique_slug_per_clinic UNIQUE (clinic_id, slug)
);

-- Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹
CREATE INDEX idx_note_block_templates_clinic ON note_block_templates(clinic_id);
CREATE INDEX idx_note_block_templates_category ON note_block_templates(category);
CREATE INDEX idx_note_block_templates_active ON note_block_templates(is_active) WHERE is_active = true;

-- RLS
ALTER TABLE note_block_templates ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view system and own clinic templates"
  ON note_block_templates FOR SELECT
  USING (
    is_system = true
    OR clinic_id IN (SELECT clinic_id FROM profiles WHERE id = auth.uid())
  );

CREATE POLICY "Users can manage own clinic templates"
  ON note_block_templates FOR ALL
  USING (
    clinic_id IN (SELECT clinic_id FROM profiles WHERE id = auth.uid())
    AND is_system = false
  );
```

#### 3.1.2 `clinical_note_templates` â€” Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½Ñ‹ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ¾Ğ² Ğ±Ğ»Ğ¾ĞºĞ¾Ğ²

```sql
CREATE TABLE clinical_note_templates (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  clinic_id UUID REFERENCES clinics(id) ON DELETE CASCADE,

  -- ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ
  name VARCHAR(100) NOT NULL,
  name_en VARCHAR(100),
  description TEXT,

  -- Ğ¡Ğ¾ÑÑ‚Ğ°Ğ² ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ° (ÑƒĞ¿Ğ¾Ñ€ÑĞ´Ğ¾Ñ‡ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¼Ğ°ÑÑĞ¸Ğ² ID Ğ±Ğ»Ğ¾ĞºĞ¾Ğ²)
  block_template_ids UUID[] NOT NULL,

  -- Ğ¤Ğ»Ğ°Ğ³Ğ¸
  is_default BOOLEAN DEFAULT false,
  is_system BOOLEAN DEFAULT false,
  is_active BOOLEAN DEFAULT true,

  -- ĞœĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now(),

  -- Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ´Ğ¸Ğ½ default Ğ½Ğ° ĞºĞ»Ğ¸Ğ½Ğ¸ĞºÑƒ
  CONSTRAINT unique_default_per_clinic UNIQUE (clinic_id, is_default)
    WHERE is_default = true
);

-- Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹
CREATE INDEX idx_clinical_note_templates_clinic ON clinical_note_templates(clinic_id);

-- RLS (Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾ note_block_templates)
ALTER TABLE clinical_note_templates ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view system and own clinic templates"
  ON clinical_note_templates FOR SELECT
  USING (
    is_system = true
    OR clinic_id IN (SELECT clinic_id FROM profiles WHERE id = auth.uid())
  );
```

### 3.2 Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ñ…

#### 3.2.1 `sections` â€” Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ĞµĞ¹

```sql
-- Ğ¡Ğ²ÑĞ·ÑŒ Ñ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ¼ Ğ±Ğ»Ğ¾ĞºĞ°
ALTER TABLE sections
ADD COLUMN IF NOT EXISTS block_template_id UUID REFERENCES note_block_templates(id);

-- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
ALTER TABLE sections
ADD COLUMN IF NOT EXISTS generation_status VARCHAR(20) DEFAULT 'pending';

ALTER TABLE sections
ADD CONSTRAINT sections_generation_status_check
CHECK (generation_status IN ('pending', 'generating', 'completed', 'failed', 'skipped'));

-- ĞÑˆĞ¸Ğ±ĞºĞ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
ALTER TABLE sections
ADD COLUMN IF NOT EXISTS generation_error TEXT;

-- Ğ—Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ Ğ°Ğ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
ALTER TABLE sections
ADD COLUMN IF NOT EXISTS anonymization_map_encrypted TEXT;

-- Ğ˜Ğ½Ğ´ĞµĞºÑ
CREATE INDEX idx_sections_generation_status ON sections(generation_status);
```

#### 3.2.2 `clinical_notes` â€” Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ĞµĞ¹

```sql
-- Ğ¡Ğ²ÑĞ·ÑŒ Ñ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ¼
ALTER TABLE clinical_notes
ADD COLUMN IF NOT EXISTS template_id UUID REFERENCES clinical_note_templates(id);

-- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ²ÑĞµĞ¹ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸
ALTER TABLE clinical_notes
ADD COLUMN IF NOT EXISTS generation_status VARCHAR(20) DEFAULT 'draft';

ALTER TABLE clinical_notes
ADD CONSTRAINT clinical_notes_generation_status_check
CHECK (generation_status IN ('draft', 'generating', 'completed', 'failed'));

-- Ğ¥ÑÑˆ Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ğ´Ğ»Ñ Ğ´ĞµÑ‚ĞµĞºÑ†Ğ¸Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹)
ALTER TABLE clinical_notes
ADD COLUMN IF NOT EXISTS source_hash VARCHAR(64);

-- Ğ˜Ğ½Ğ´ĞµĞºÑ
CREATE INDEX idx_clinical_notes_generation_status ON clinical_notes(generation_status);
```

#### 3.2.3 `patients` â€” Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»Ñ Ğ´Ğ»Ñ Case Summary

```sql
-- AI-ÑĞ²Ğ¾Ğ´ĞºĞ° Ğ¿Ğ¾ ÑĞ»ÑƒÑ‡Ğ°Ñ (Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ)
ALTER TABLE patients
ADD COLUMN IF NOT EXISTS case_summary_encrypted TEXT;

ALTER TABLE patients
ADD COLUMN IF NOT EXISTS case_summary_generated_at TIMESTAMPTZ;
```

### 3.3 Seed Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… â€” Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸

```sql
-- Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸ Ğ´Ğ»Ñ Initial Psychiatric Assessment
INSERT INTO note_block_templates (
  id, clinic_id, name, name_en, slug, description, category, system_prompt, is_system, position
) VALUES
-- 1. ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ
(
  gen_random_uuid(),
  NULL,
  'ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ',
  'Contact Reason',
  'contact_reason',
  'ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°, Ğ¿Ğ¾ ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ğ»ÑÑ Ğ·Ğ° Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ',
  'assessment',
  'Ğ¢Ñ‹ â€” Ğ¾Ğ¿Ñ‹Ñ‚Ğ½Ñ‹Ğ¹ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€. ĞĞ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ° ÑĞµÑÑĞ¸Ğ¸ ÑÑ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ¸Ñ€ÑƒĞ¹ Ğ¿Ñ€Ğ¸Ñ‡Ğ¸Ğ½Ñƒ Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ°.
ĞĞ°Ğ¿Ğ¸ÑˆĞ¸ 2-4 Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ, Ğ¾Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ÑÑ‰Ğ¸Ğµ:
- ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ğ»ÑÑ Ğ·Ğ° Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ
- ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¶Ğ°Ğ»Ğ¾Ğ±Ñ‹
- ĞšĞ°Ğº Ğ´Ğ¾Ğ»Ğ³Ğ¾ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°
- Ğ§Ñ‚Ğ¾ Ğ¿Ğ¾ÑĞ»ÑƒĞ¶Ğ¸Ğ»Ğ¾ Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ğ¾Ğ¼ Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ

ĞŸĞ¸ÑˆĞ¸ Ğ¾Ñ‚ Ñ‚Ñ€ĞµÑ‚ÑŒĞµĞ³Ğ¾ Ğ»Ğ¸Ñ†Ğ° ("ĞŸĞ°Ñ†Ğ¸ĞµĞ½Ñ‚ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ¸Ğ»ÑÑ...", "ĞŸĞ°Ñ†Ğ¸ĞµĞ½Ñ‚ ÑĞ¾Ğ¾Ğ±Ñ‰Ğ°ĞµÑ‚...").
Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¼ĞµĞ´Ğ¸Ñ†Ğ¸Ğ½ÑĞºĞ¸Ğ¹ ÑĞ·Ñ‹Ğº, Ğ½Ğ¾ Ğ¸Ğ·Ğ±ĞµĞ³Ğ°Ğ¹ Ğ¸Ğ·Ğ»Ğ¸ÑˆĞ½ĞµĞ³Ğ¾ Ğ¶Ğ°Ñ€Ğ³Ğ¾Ğ½Ğ°.',
  true,
  1
),

-- 2. Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰ĞµĞ³Ğ¾ Ğ·Ğ°Ğ±Ğ¾Ğ»ĞµĞ²Ğ°Ğ½Ğ¸Ñ
(
  gen_random_uuid(),
  NULL,
  'Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰ĞµĞ³Ğ¾ Ğ·Ğ°Ğ±Ğ¾Ğ»ĞµĞ²Ğ°Ğ½Ğ¸Ñ',
  'History of Present Illness',
  'history_present_illness',
  'Ğ Ğ°Ğ·Ğ²Ğ¸Ñ‚Ğ¸Ğµ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ñ… ÑĞ¸Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼Ğ¾Ğ² Ğ¸ Ğ¸Ñ… Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸',
  'history',
  'Ğ¢Ñ‹ â€” Ğ¾Ğ¿Ñ‹Ñ‚Ğ½Ñ‹Ğ¹ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€. ĞĞ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ° ÑĞµÑÑĞ¸Ğ¸ Ğ¾Ğ¿Ğ¸ÑˆĞ¸ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰ĞµĞ³Ğ¾ Ğ·Ğ°Ğ±Ğ¾Ğ»ĞµĞ²Ğ°Ğ½Ğ¸Ñ.
Ğ’ĞºĞ»ÑÑ‡Ğ¸:
- Ğ¥Ñ€Ğ¾Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ Ñ€Ğ°Ğ·Ğ²Ğ¸Ñ‚Ğ¸Ñ ÑĞ¸Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼Ğ¾Ğ²
- Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€ Ğ¸ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ ÑĞ¸Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼Ğ¾Ğ²
- ĞŸÑ€Ğ¾Ğ²Ğ¾Ñ†Ğ¸Ñ€ÑƒÑÑ‰Ğ¸Ğµ Ğ¸ Ğ¾Ğ±Ğ»ĞµĞ³Ñ‡Ğ°ÑÑ‰Ğ¸Ğµ Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ñ‹
- Ğ’Ğ»Ğ¸ÑĞ½Ğ¸Ğµ Ğ½Ğ° Ğ¿Ğ¾Ğ²ÑĞµĞ´Ğ½ĞµĞ²Ğ½ÑƒÑ Ğ¶Ğ¸Ğ·Ğ½ÑŒ
- ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğµ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ¸ ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒÑÑ Ñ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ¾Ğ¹

ĞŸĞ¸ÑˆĞ¸ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾, Ğ¾Ñ‚ Ñ‚Ñ€ĞµÑ‚ÑŒĞµĞ³Ğ¾ Ğ»Ğ¸Ñ†Ğ°. Ğ”Ğ»Ğ¸Ğ½Ğ°: 1-2 Ğ°Ğ±Ğ·Ğ°Ñ†Ğ°.',
  true,
  2
),

-- 3. ĞŸÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ°Ğ½Ğ°Ğ¼Ğ½ĞµĞ·
(
  gen_random_uuid(),
  NULL,
  'ĞŸÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ°Ğ½Ğ°Ğ¼Ğ½ĞµĞ·',
  'Past Psychiatric History',
  'past_psychiatric',
  'ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğµ Ğ¿ÑĞ¸Ñ…Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ€Ğ°ÑÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°, Ğ³Ğ¾ÑĞ¿Ğ¸Ñ‚Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸, Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ',
  'history',
  'Ğ¢Ñ‹ â€” Ğ¾Ğ¿Ñ‹Ñ‚Ğ½Ñ‹Ğ¹ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€. ĞĞ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ° ÑĞµÑÑĞ¸Ğ¸ Ğ¾Ğ¿Ğ¸ÑˆĞ¸ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ°Ğ½Ğ°Ğ¼Ğ½ĞµĞ· Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ°.
Ğ’ĞºĞ»ÑÑ‡Ğ¸ (ĞµÑĞ»Ğ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°):
- ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğµ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾Ğ·Ñ‹
- Ğ“Ğ¾ÑĞ¿Ğ¸Ñ‚Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ² Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ ÑƒÑ‡Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ
- ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞµ Ğ¼ĞµĞ´Ğ¸ĞºĞ°Ğ¼ĞµĞ½Ñ‚Ğ¾Ğ·Ğ½Ğ¾Ğµ Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ (Ğ¿Ñ€ĞµĞ¿Ğ°Ñ€Ğ°Ñ‚Ñ‹, Ğ´Ğ¾Ğ·Ñ‹, ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ)
- ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ°Ñ Ğ¿ÑĞ¸Ñ…Ğ¾Ñ‚ĞµÑ€Ğ°Ğ¿Ğ¸Ñ (Ñ‚Ğ¸Ğ¿, Ğ´Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ, Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚)
- Ğ¡ÑƒĞ¸Ñ†Ğ¸Ğ´Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ¸ Ğ¸Ğ»Ğ¸ ÑĞ°Ğ¼Ğ¾Ğ¿Ğ¾Ğ²Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ² Ğ°Ğ½Ğ°Ğ¼Ğ½ĞµĞ·Ğµ

Ğ•ÑĞ»Ğ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ½Ğµ ÑƒĞ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°ĞµÑ‚ÑÑ, Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸ "Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ½Ğµ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ°" Ğ¸Ğ»Ğ¸ "ĞÑ‚Ñ€Ğ¸Ñ†Ğ°ĞµÑ‚".
ĞŸĞ¸ÑˆĞ¸ Ğ¾Ñ‚ Ñ‚Ñ€ĞµÑ‚ÑŒĞµĞ³Ğ¾ Ğ»Ğ¸Ñ†Ğ°.',
  true,
  3
),

-- 4. Ğ¡Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ°Ğ½Ğ°Ğ¼Ğ½ĞµĞ·
(
  gen_random_uuid(),
  NULL,
  'Ğ¡Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ°Ğ½Ğ°Ğ¼Ğ½ĞµĞ·',
  'Somatic History',
  'somatic_history',
  'Ğ¤Ğ¸Ğ·Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ, Ñ…Ñ€Ğ¾Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ·Ğ°Ğ±Ğ¾Ğ»ĞµĞ²Ğ°Ğ½Ğ¸Ñ, Ğ¼ĞµĞ´Ğ¸ĞºĞ°Ğ¼ĞµĞ½Ñ‚Ñ‹',
  'history',
  'Ğ¢Ñ‹ â€” Ğ¾Ğ¿Ñ‹Ñ‚Ğ½Ñ‹Ğ¹ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€. ĞĞ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ° ÑĞµÑÑĞ¸Ğ¸ Ğ¾Ğ¿Ğ¸ÑˆĞ¸ ÑĞ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ°Ğ½Ğ°Ğ¼Ğ½ĞµĞ· Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ°.
Ğ’ĞºĞ»ÑÑ‡Ğ¸:
- Ğ¥Ñ€Ğ¾Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ·Ğ°Ğ±Ğ¾Ğ»ĞµĞ²Ğ°Ğ½Ğ¸Ñ
- Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğµ ÑĞ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¶Ğ°Ğ»Ğ¾Ğ±Ñ‹
- ĞŸÑ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµĞ¼Ñ‹Ğµ Ğ¼ĞµĞ´Ğ¸ĞºĞ°Ğ¼ĞµĞ½Ñ‚Ñ‹ (Ğ½Ğµ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ)
- ĞĞ»Ğ»ĞµÑ€Ğ³Ğ¸Ğ¸
- ĞŸĞµÑ€ĞµĞ½ĞµÑÑ‘Ğ½Ğ½Ñ‹Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ Ñ‚Ñ€Ğ°Ğ²Ğ¼Ñ‹

Ğ•ÑĞ»Ğ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ½Ğµ ÑƒĞ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°ĞµÑ‚ÑÑ, ÑƒĞºĞ°Ğ¶Ğ¸ "Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ½Ğµ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ°".
ĞŸĞ¸ÑˆĞ¸ ĞºÑ€Ğ°Ñ‚ĞºĞ¾, Ğ¾Ñ‚ Ñ‚Ñ€ĞµÑ‚ÑŒĞµĞ³Ğ¾ Ğ»Ğ¸Ñ†Ğ°.',
  true,
  4
),

-- 5. Ğ£Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ğµ ĞŸĞĞ’
(
  gen_random_uuid(),
  NULL,
  'Ğ£Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ğµ ĞŸĞĞ’',
  'Substance Use',
  'substance_use',
  'ĞĞ»ĞºĞ¾Ğ³Ğ¾Ğ»ÑŒ, Ğ½Ğ°Ñ€ĞºĞ¾Ñ‚Ğ¸ĞºĞ¸, Ğ½Ğ¸ĞºĞ¾Ñ‚Ğ¸Ğ½, Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ Ğ¿ÑĞ¸Ñ…Ğ¾Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ²ĞµÑ‰ĞµÑÑ‚Ğ²Ğ°',
  'history',
  'Ğ¢Ñ‹ â€” Ğ¾Ğ¿Ñ‹Ñ‚Ğ½Ñ‹Ğ¹ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€. ĞĞ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ° ÑĞµÑÑĞ¸Ğ¸ Ğ¾Ğ¿Ğ¸ÑˆĞ¸ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ÑƒĞ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ñ Ğ¿ÑĞ¸Ñ…Ğ¾Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ²ĞµÑ‰ĞµÑÑ‚Ğ².
Ğ’ĞºĞ»ÑÑ‡Ğ¸:
- ĞĞ»ĞºĞ¾Ğ³Ğ¾Ğ»ÑŒ (Ñ‡Ğ°ÑÑ‚Ğ¾Ñ‚Ğ°, ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾, Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½ ÑƒĞ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ñ)
- Ğ¢Ğ°Ğ±Ğ°Ğº/Ğ½Ğ¸ĞºĞ¾Ñ‚Ğ¸Ğ½
- ĞĞ°Ñ€ĞºĞ¾Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ²ĞµÑ‰ĞµÑÑ‚Ğ²Ğ° (ĞºĞ°ĞºĞ¸Ğµ, Ñ‡Ğ°ÑÑ‚Ğ¾Ñ‚Ğ°)
- Ğ—Ğ»Ğ¾ÑƒĞ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ğµ Ğ»ĞµĞºĞ°Ñ€ÑÑ‚Ğ²Ğ°Ğ¼Ğ¸
- ĞŸÑ€Ğ¸Ğ·Ğ½Ğ°ĞºĞ¸ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¸Ğ»Ğ¸ Ğ°Ğ±ÑÑ‚Ğ¸Ğ½ĞµĞ½Ñ†Ğ¸Ğ¸

Ğ•ÑĞ»Ğ¸ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚ Ğ¾Ñ‚Ñ€Ğ¸Ñ†Ğ°ĞµÑ‚ ÑƒĞ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ğµ, ÑƒĞºĞ°Ğ¶Ğ¸ ÑÑ‚Ğ¾ ÑĞ²Ğ½Ğ¾.
ĞŸĞ¸ÑˆĞ¸ Ğ¾Ñ‚ Ñ‚Ñ€ĞµÑ‚ÑŒĞµĞ³Ğ¾ Ğ»Ğ¸Ñ†Ğ°, Ğ±ĞµĞ· Ğ¾ÑÑƒĞ¶Ğ´ĞµĞ½Ğ¸Ñ.',
  true,
  5
),

-- 6. Ğ¡ĞµĞ¼ĞµĞ¹Ğ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ¼Ğ½ĞµĞ·
(
  gen_random_uuid(),
  NULL,
  'Ğ¡ĞµĞ¼ĞµĞ¹Ğ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ¼Ğ½ĞµĞ·',
  'Family History',
  'family_history',
  'ĞŸÑĞ¸Ñ…Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ·Ğ°Ğ±Ğ¾Ğ»ĞµĞ²Ğ°Ğ½Ğ¸Ñ Ğ² ÑĞµĞ¼ÑŒĞµ, Ğ½Ğ°ÑĞ»ĞµĞ´ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ',
  'history',
  'Ğ¢Ñ‹ â€” Ğ¾Ğ¿Ñ‹Ñ‚Ğ½Ñ‹Ğ¹ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€. ĞĞ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ° ÑĞµÑÑĞ¸Ğ¸ Ğ¾Ğ¿Ğ¸ÑˆĞ¸ ÑĞµĞ¼ĞµĞ¹Ğ½Ñ‹Ğ¹ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ°Ğ½Ğ°Ğ¼Ğ½ĞµĞ·.
Ğ’ĞºĞ»ÑÑ‡Ğ¸:
- ĞŸÑĞ¸Ñ…Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ€Ğ°ÑÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ñƒ Ñ€Ğ¾Ğ´ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¸ĞºĞ¾Ğ² Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¹ Ğ»Ğ¸Ğ½Ğ¸Ğ¸ (Ñ€Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ğ¸, Ğ±Ñ€Ğ°Ñ‚ÑŒÑ/ÑÑ‘ÑÑ‚Ñ€Ñ‹, Ğ´ĞµÑ‚Ğ¸)
- ĞŸÑĞ¸Ñ…Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ€Ğ°ÑÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ñƒ Ñ€Ğ¾Ğ´ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¸ĞºĞ¾Ğ² Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ Ğ»Ğ¸Ğ½Ğ¸Ğ¸
- Ğ¡ÑƒĞ¸Ñ†Ğ¸Ğ´Ñ‹ Ğ² ÑĞµĞ¼ÑŒĞµ
- Ğ—Ğ»Ğ¾ÑƒĞ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ğµ ĞŸĞĞ’ Ğ² ÑĞµĞ¼ÑŒĞµ

Ğ•ÑĞ»Ğ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ½Ğµ ÑƒĞ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°ĞµÑ‚ÑÑ, Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸ "Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ½Ğµ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ°".
ĞŸĞ¸ÑˆĞ¸ Ğ¾Ñ‚ Ñ‚Ñ€ĞµÑ‚ÑŒĞµĞ³Ğ¾ Ğ»Ğ¸Ñ†Ğ°.',
  true,
  6
),

-- 7. Ğ¡Ğ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ¼Ğ½ĞµĞ·
(
  gen_random_uuid(),
  NULL,
  'Ğ¡Ğ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ¼Ğ½ĞµĞ·',
  'Social History',
  'social_history',
  'ĞĞ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ, Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°, Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ, ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ¶Ğ¸Ğ·Ğ½Ğ¸',
  'history',
  'Ğ¢Ñ‹ â€” Ğ¾Ğ¿Ñ‹Ñ‚Ğ½Ñ‹Ğ¹ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€. ĞĞ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ° ÑĞµÑÑĞ¸Ğ¸ Ğ¾Ğ¿Ğ¸ÑˆĞ¸ ÑĞ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ°Ğ½Ğ°Ğ¼Ğ½ĞµĞ· Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ°.
Ğ’ĞºĞ»ÑÑ‡Ğ¸:
- ĞĞ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
- Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ·Ğ°Ğ½ÑÑ‚Ğ¾ÑÑ‚ÑŒ / Ğ¿Ñ€Ğ¾Ñ„ĞµÑÑĞ¸Ñ
- Ğ¡ĞµĞ¼ĞµĞ¹Ğ½Ğ¾Ğµ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ
- Ğ”ĞµÑ‚Ğ¸
- Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ
- Ğ¡Ğ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°
- Ğ—Ğ½Ğ°Ñ‡Ğ¸Ğ¼Ñ‹Ğµ Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ

ĞŸĞ¸ÑˆĞ¸ Ğ¾Ñ‚ Ñ‚Ñ€ĞµÑ‚ÑŒĞµĞ³Ğ¾ Ğ»Ğ¸Ñ†Ğ°, ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾.',
  true,
  7
),

-- 8. Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ñ‚ĞµÑ€Ğ°Ğ¿Ğ¸Ñ
(
  gen_random_uuid(),
  NULL,
  'Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ñ‚ĞµÑ€Ğ°Ğ¿Ğ¸Ñ',
  'Current Treatment',
  'current_treatment',
  'Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ¿Ñ€ĞµĞ¿Ğ°Ñ€Ğ°Ñ‚Ñ‹ Ğ¸ Ğ¿ÑĞ¸Ñ…Ğ¾Ñ‚ĞµÑ€Ğ°Ğ¿Ğ¸Ñ',
  'treatment',
  'Ğ¢Ñ‹ â€” Ğ¾Ğ¿Ñ‹Ñ‚Ğ½Ñ‹Ğ¹ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€. ĞĞ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ° ÑĞµÑÑĞ¸Ğ¸ Ğ¾Ğ¿Ğ¸ÑˆĞ¸ Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ°.
Ğ’ĞºĞ»ÑÑ‡Ğ¸:
- Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¿Ñ€ĞµĞ¿Ğ°Ñ€Ğ°Ñ‚Ñ‹ (Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ, Ğ´Ğ¾Ğ·Ñ‹, Ğ´Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°)
- Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ Ğ¿ÑĞ¸Ñ…Ğ¾Ñ‚ĞµÑ€Ğ°Ğ¿Ğ¸Ñ (Ñ‚Ğ¸Ğ¿, Ñ‡Ğ°ÑÑ‚Ğ¾Ñ‚Ğ°, Ñ‚ĞµÑ€Ğ°Ğ¿ĞµĞ²Ñ‚)
- Ğ­Ñ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ
- ĞŸĞ¾Ğ±Ğ¾Ñ‡Ğ½Ñ‹Ğµ ÑÑ„Ñ„ĞµĞºÑ‚Ñ‹
- ĞšĞ¾Ğ¼Ğ¿Ğ»Ğ°ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ

Ğ•ÑĞ»Ğ¸ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚ Ğ½Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ, ÑƒĞºĞ°Ğ¶Ğ¸ ÑÑ‚Ğ¾.
ĞŸĞ¸ÑˆĞ¸ Ğ¾Ñ‚ Ñ‚Ñ€ĞµÑ‚ÑŒĞµĞ³Ğ¾ Ğ»Ğ¸Ñ†Ğ°.',
  true,
  8
),

-- 9. ĞŸÑĞ¸Ñ…Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ
(
  gen_random_uuid(),
  NULL,
  'ĞŸÑĞ¸Ñ…Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ',
  'Mental Status Examination',
  'mental_status',
  'ĞÑ†ĞµĞ½ĞºĞ° Ğ¿ÑĞ¸Ñ…Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ½Ğ° Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚ Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° (MSE)',
  'status',
  'Ğ¢Ñ‹ â€” Ğ¾Ğ¿Ñ‹Ñ‚Ğ½Ñ‹Ğ¹ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€. ĞĞ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ° ÑĞµÑÑĞ¸Ğ¸ Ğ¾Ğ¿Ğ¸ÑˆĞ¸ Ğ¿ÑĞ¸Ñ…Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ° (MSE).
Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°:
- Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ Ğ²Ğ¸Ğ´ Ğ¸ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ
- Ğ ĞµÑ‡ÑŒ (Ñ‚ĞµĞ¼Ğ¿, Ğ³Ñ€Ğ¾Ğ¼ĞºĞ¾ÑÑ‚ÑŒ, ÑĞ²ÑĞ·Ğ½Ğ¾ÑÑ‚ÑŒ)
- ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ (ÑĞ¾ ÑĞ»Ğ¾Ğ² Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ°) Ğ¸ Ğ°Ñ„Ñ„ĞµĞºÑ‚ (Ğ½Ğ°Ğ±Ğ»ÑĞ´Ğ°ĞµĞ¼Ñ‹Ğ¹)
- ĞœÑ‹ÑˆĞ»ĞµĞ½Ğ¸Ğµ (Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ¸ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ)
- Ğ’Ğ¾ÑĞ¿Ñ€Ğ¸ÑÑ‚Ğ¸Ğµ (Ğ³Ğ°Ğ»Ğ»ÑÑ†Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¸, Ğ¸Ğ»Ğ»ÑĞ·Ğ¸Ğ¸)
- ĞšĞ¾Ğ³Ğ½Ğ¸Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ (Ğ¾Ñ€Ğ¸ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ, Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ, Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ)
- Ğ˜Ğ½ÑĞ°Ğ¹Ñ‚ Ğ¸ ĞºÑ€Ğ¸Ñ‚Ğ¸ĞºĞ°

Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½ÑƒÑ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€Ğ¸Ñ‡ĞµÑĞºÑƒÑ Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ.
ĞŸĞ¸ÑˆĞ¸ Ğ¾Ñ‚ Ñ‚Ñ€ĞµÑ‚ÑŒĞµĞ³Ğ¾ Ğ»Ğ¸Ñ†Ğ°.',
  true,
  9
),

-- 10. ĞÑ†ĞµĞ½ĞºĞ° Ñ€Ğ¸ÑĞºĞ¾Ğ²
(
  gen_random_uuid(),
  NULL,
  'ĞÑ†ĞµĞ½ĞºĞ° Ñ€Ğ¸ÑĞºĞ¾Ğ²',
  'Risk Assessment',
  'risk_assessment',
  'ĞÑ†ĞµĞ½ĞºĞ° ÑÑƒĞ¸Ñ†Ğ¸Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ñ€Ğ¸ÑĞºĞ°, Ñ€Ğ¸ÑĞºĞ° ÑĞ°Ğ¼Ğ¾Ğ¿Ğ¾Ğ²Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ¸ Ğ°Ğ³Ñ€ĞµÑÑĞ¸Ğ¸',
  'status',
  'Ğ¢Ñ‹ â€” Ğ¾Ğ¿Ñ‹Ñ‚Ğ½Ñ‹Ğ¹ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€. ĞĞ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ° ÑĞµÑÑĞ¸Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµĞ´Ğ¸ Ğ¾Ñ†ĞµĞ½ĞºÑƒ Ñ€Ğ¸ÑĞºĞ¾Ğ².
ĞÑ†ĞµĞ½Ğ¸:

1. Ğ¡ÑƒĞ¸Ñ†Ğ¸Ğ´Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ğ¸ÑĞº:
   - Ğ¡ÑƒĞ¸Ñ†Ğ¸Ğ´Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¼Ñ‹ÑĞ»Ğ¸ (Ğ¿Ğ°ÑÑĞ¸Ğ²Ğ½Ñ‹Ğµ/Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ)
   - ĞŸĞ»Ğ°Ğ½Ñ‹ Ğ¸ Ğ½Ğ°Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ñ
   - Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğº ÑÑ€ĞµĞ´ÑÑ‚Ğ²Ğ°Ğ¼
   - Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ½Ñ‹Ğµ Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ñ‹

2. Ğ Ğ¸ÑĞº ÑĞ°Ğ¼Ğ¾Ğ¿Ğ¾Ğ²Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ:
   - Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ°Ğ¼Ğ¾Ğ¿Ğ¾Ğ²Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ
   - Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ÑĞ°Ğ¼Ğ¾Ğ¿Ğ¾Ğ²Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ

3. Ğ Ğ¸ÑĞº Ğ´Ğ»Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ…:
   - ĞĞ³Ñ€ĞµÑÑĞ¸Ğ²Ğ½Ñ‹Ğµ Ğ¼Ñ‹ÑĞ»Ğ¸ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ
   - Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ½Ğ°ÑĞ¸Ğ»Ğ¸Ñ

Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸ Ğ¾Ğ±Ñ‰ĞµĞ¹ Ğ¾Ñ†ĞµĞ½ĞºĞ¾Ğ¹ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ Ñ€Ğ¸ÑĞºĞ° (Ğ½Ğ¸Ğ·ĞºĞ¸Ğ¹/ÑƒĞ¼ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹/Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹) Ñ Ğ¾Ğ±Ğ¾ÑĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼.
ĞŸĞ¸ÑˆĞ¸ Ğ¾Ñ‚ Ñ‚Ñ€ĞµÑ‚ÑŒĞµĞ³Ğ¾ Ğ»Ğ¸Ñ†Ğ°, Ñ‡Ñ‘Ñ‚ĞºĞ¾ Ğ¸ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾.',
  true,
  10
),

-- 11. Ğ—Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ¿Ğ»Ğ°Ğ½
(
  gen_random_uuid(),
  NULL,
  'Ğ—Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ¿Ğ»Ğ°Ğ½',
  'Conclusion and Plan',
  'conclusion_plan',
  'Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ²Ğ¿ĞµÑ‡Ğ°Ñ‚Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ¿Ğ»Ğ°Ğ½ Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ',
  'conclusion',
  'Ğ¢Ñ‹ â€” Ğ¾Ğ¿Ñ‹Ñ‚Ğ½Ñ‹Ğ¹ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€. ĞĞ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ° ÑĞµÑÑĞ¸Ğ¸ ÑÑ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ¸Ñ€ÑƒĞ¹ Ğ·Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ¿Ğ»Ğ°Ğ½.

1. Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ²Ğ¿ĞµÑ‡Ğ°Ñ‚Ğ»ĞµĞ½Ğ¸Ğµ:
   - ĞŸÑ€ĞµĞ´Ğ²Ğ°Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾Ğ· (Ğ¸Ğ»Ğ¸ Ğ´Ğ¸Ñ„Ñ„ĞµÑ€ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹)
   - ĞĞ±Ğ¾ÑĞ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

2. ĞŸĞ»Ğ°Ğ½ Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ:
   - ĞœĞµĞ´Ğ¸ĞºĞ°Ğ¼ĞµĞ½Ñ‚Ğ¾Ğ·Ğ½Ğ°Ñ Ñ‚ĞµÑ€Ğ°Ğ¿Ğ¸Ñ (ĞµÑĞ»Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ°)
   - ĞŸÑĞ¸Ñ…Ğ¾Ñ‚ĞµÑ€Ğ°Ğ¿Ğ¸Ñ (Ñ‚Ğ¸Ğ¿, Ñ‡Ğ°ÑÑ‚Ğ¾Ñ‚Ğ°)
   - Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ğ±ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
   - ĞĞ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğº Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸ÑÑ‚Ğ°Ğ¼

3. ĞŸĞ»Ğ°Ğ½ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸ (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ñ€Ğ¸ÑĞºĞ¸)

4. Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼

ĞŸĞ¸ÑˆĞ¸ Ğ¿Ñ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾, Ğ¾Ñ‚ Ñ‚Ñ€ĞµÑ‚ÑŒĞµĞ³Ğ¾ Ğ»Ğ¸Ñ†Ğ°.',
  true,
  11
);

-- Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¹ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ° Ğ±Ğ»Ğ¾ĞºĞ¾Ğ²
INSERT INTO clinical_note_templates (
  id, clinic_id, name, name_en, description, block_template_ids, is_default, is_system
) VALUES (
  gen_random_uuid(),
  NULL,
  'ĞŸĞµÑ€Ğ²Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ°',
  'Initial Psychiatric Assessment',
  'ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ¿ĞµÑ€Ğ²Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ° Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ²',
  (SELECT ARRAY_AGG(id ORDER BY position) FROM note_block_templates WHERE is_system = true),
  true,
  true
);
```

---

## 4. API Endpoints

### 4.1 Ğ‘Ğ»Ğ¾ĞºĞ¸ Ğ¸ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ñ‹

#### GET `/api/ai/block-templates`

ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ğ±Ğ»Ğ¾ĞºĞ¾Ğ².

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "name": "ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ",
      "name_en": "Contact Reason",
      "slug": "contact_reason",
      "description": "...",
      "category": "assessment",
      "is_system": true,
      "position": 1
    }
  ]
}
```

#### GET `/api/ai/note-templates`

ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ² Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ¾Ğ² Ğ±Ğ»Ğ¾ĞºĞ¾Ğ².

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "name": "ĞŸĞµÑ€Ğ²Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ°",
      "description": "...",
      "block_template_ids": ["uuid1", "uuid2", ...],
      "is_default": true,
      "is_system": true,
      "blocks": [
        { "id": "uuid1", "name": "ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ", ... },
        { "id": "uuid2", "name": "Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰ĞµĞ³Ğ¾ Ğ·Ğ°Ğ±Ğ¾Ğ»ĞµĞ²Ğ°Ğ½Ğ¸Ñ", ... }
      ]
    }
  ]
}
```

### 4.2 Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ

#### POST `/api/ai/generate`

Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸.

**Request:**
```json
{
  "session_id": "uuid",
  "template_id": "uuid",
  "source_type": "transcript" | "notes" | "combined"
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "clinical_note_id": "uuid",
    "status": "generating",
    "sections_count": 11
  }
}
```

**Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°:**
1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ, Ñ‡Ñ‚Ğ¾ ÑĞµÑÑĞ¸Ñ Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ğ°Ğ½Ğ° Ğº Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ñƒ (Ğ¸Ğ½Ğ°Ñ‡Ğµ â€” Ğ¾ÑˆĞ¸Ğ±ĞºĞ° 400)
2. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ¸/Ğ¸Ğ»Ğ¸ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ ÑĞµÑÑĞ¸Ğ¸
3. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ° Ğ´Ğ»Ñ Ğ°Ğ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
4. ĞĞ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‚ĞµĞºÑÑ‚
5. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ `clinical_note` ÑĞ¾ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ¾Ğ¼ `generating`
6. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ `sections` Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ° ÑĞ¾ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ¾Ğ¼ `pending`
7. Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½ÑƒÑ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ (Promise.all)
8. Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ°:
   - ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğº OpenAI Ñ system_prompt Ğ±Ğ»Ğ¾ĞºĞ°
   - Ğ”Ğµ-Ğ°Ğ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚
   - Ğ—Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚
   - ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ section (status: `completed`, ai_content)
9. ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ clinical_note (status: `completed`)
10. Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ² audit_log

#### GET `/api/ai/generate/:clinicalNoteId/status`

ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸.

**Response:**
```json
{
  "success": true,
  "data": {
    "clinical_note_id": "uuid",
    "status": "generating",
    "progress": {
      "total": 11,
      "completed": 6,
      "failed": 0
    },
    "sections": [
      { "id": "uuid", "name": "ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ", "status": "completed" },
      { "id": "uuid", "name": "Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰ĞµĞ³Ğ¾ Ğ·Ğ°Ğ±Ğ¾Ğ»ĞµĞ²Ğ°Ğ½Ğ¸Ñ", "status": "completed" },
      { "id": "uuid", "name": "ĞŸÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ°Ğ½Ğ°Ğ¼Ğ½ĞµĞ·", "status": "generating" },
      ...
    ]
  }
}
```

#### POST `/api/ai/regenerate-section/:sectionId`

ĞŸĞµÑ€ĞµĞ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ°.

**Request:**
```json
{
  "custom_prompt": "Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ğ¾..."  // Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "section_id": "uuid",
    "status": "completed",
    "ai_content": "..."
  }
}
```

### 4.3 Case Summary

#### POST `/api/ai/case-summary`

Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑĞ²Ğ¾Ğ´ĞºĞ¸ Ğ¿Ğ¾ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ñƒ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ²ÑĞµÑ… ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ·Ğ°Ğ¼ĞµÑ‚Ğ¾Ğº.

**Request:**
```json
{
  "patient_id": "uuid"
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "patient_id": "uuid",
    "case_summary": "...",
    "generated_at": "2025-12-08T12:00:00Z",
    "based_on_notes_count": 5
  }
}
```

**Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°:**
1. Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ²ÑĞµ `clinical_notes` Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ° ÑĞ¾ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ¾Ğ¼ `completed` Ğ¸Ğ»Ğ¸ `finalized`
2. ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½Ğ¸Ñ‚ÑŒ ai_summary Ğ¸Ğ· ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸
3. ĞĞ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ
4. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² OpenAI Ñ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼ Ğ´Ğ»Ñ ÑĞ²Ğ¾Ğ´ĞºĞ¸
5. Ğ”Ğµ-Ğ°Ğ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ
6. Ğ—Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ² `patients.case_summary_encrypted`

---

## 5. ĞĞ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

### 5.1 Ğ¢Ğ¸Ğ¿Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ Ğ°Ğ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ (PHI)

| Ğ¢Ğ¸Ğ¿ | ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ | ĞŸĞ»ĞµĞ¹ÑÑ…Ğ¾Ğ»Ğ´ĞµÑ€ |
|-----|---------|-------------|
| Ğ˜Ğ¼Ñ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ° | ĞĞ½Ğ½Ğ° ĞŸĞµÑ‚Ñ€Ğ¾Ğ²Ğ° | `[PATIENT_NAME]` |
| Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚ | 32 Ğ³Ğ¾Ğ´Ğ° | `[AGE]` |
| Ğ”Ğ°Ñ‚Ğ° Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ | 15.03.1992 | `[DOB]` |
| ĞĞ´Ñ€ĞµÑ | ÑƒĞ». Ğ›ĞµĞ½Ğ¸Ğ½Ğ°, 15 | `[ADDRESS]` |
| Ğ“Ğ¾Ñ€Ğ¾Ğ´ | ĞœĞ¾ÑĞºĞ²Ğ° | `[CITY]` |
| Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½ | +7 999 123-45-67 | `[PHONE]` |
| Email | anna@mail.ru | `[EMAIL]` |
| Ğ˜Ğ¼ĞµĞ½Ğ° Ñ€Ğ¾Ğ´ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¸ĞºĞ¾Ğ² | ÑĞµÑÑ‚Ñ€Ğ° ĞœĞ°Ñ€Ğ¸Ñ | `[RELATIVE_1]`, `[RELATIVE_2]` |
| ĞœĞµÑÑ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ | Ğ¡Ğ±ĞµÑ€Ğ±Ğ°Ğ½Ğº | `[EMPLOYER]` |
| ĞšĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğµ Ğ´Ğ°Ñ‚Ñ‹ | 15 Ğ¼Ğ°Ñ€Ñ‚Ğ° 2024 | `[DATE_1]`, `[DATE_2]` |
| Ğ’Ñ€Ğ°Ñ‡Ğ¸ | Ğ´-Ñ€ Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ² | `[DOCTOR_1]` |

### 5.2 ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ Ğ°Ğ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

```typescript
// src/lib/anonymization.ts

interface AnonymizationResult {
  text: string;
  map: Record<string, string>;
}

interface Patient {
  name: string;
  email?: string;
  phone?: string;
  address?: string;
  date_of_birth?: string;
}

export function anonymize(text: string, patient: Patient): AnonymizationResult {
  const map: Record<string, string> = {};
  let anonymized = text;
  let relativeCounter = 1;
  let dateCounter = 1;

  // 1. Ğ—Ğ°Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ°
  if (patient.name) {
    anonymized = replaceAll(anonymized, patient.name, '[PATIENT_NAME]');
    map['[PATIENT_NAME]'] = patient.name;

    // Ğ¢Ğ°ĞºĞ¶Ğµ Ğ·Ğ°Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ¸Ğ¼Ñ Ğ¸ Ñ„Ğ°Ğ¼Ğ¸Ğ»Ğ¸Ñ Ğ¿Ğ¾ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸
    const nameParts = patient.name.split(' ');
    nameParts.forEach((part, i) => {
      if (part.length > 2) {
        anonymized = replaceAll(anonymized, part, `[PATIENT_NAME_PART_${i}]`);
        map[`[PATIENT_NAME_PART_${i}]`] = part;
      }
    });
  }

  if (patient.phone) {
    anonymized = replaceAll(anonymized, patient.phone, '[PHONE]');
    map['[PHONE]'] = patient.phone;
  }

  if (patient.email) {
    anonymized = replaceAll(anonymized, patient.email, '[EMAIL]');
    map['[EMAIL]'] = patient.email;
  }

  if (patient.address) {
    anonymized = replaceAll(anonymized, patient.address, '[ADDRESS]');
    map['[ADDRESS]'] = patient.address;
  }

  // 2. Regex Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ´Ğ»Ñ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ¾Ğ²
  const phoneRegex = /(\+7|8)[\s\-]?\(?\d{3}\)?[\s\-]?\d{3}[\s\-]?\d{2}[\s\-]?\d{2}/g;
  anonymized = anonymized.replace(phoneRegex, (match) => {
    if (!map['[PHONE]']) {
      map['[PHONE]'] = match;
    }
    return '[PHONE]';
  });

  // 3. Regex Ğ´Ğ»Ñ email
  const emailRegex = /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g;
  anonymized = anonymized.replace(emailRegex, (match) => {
    if (!map['[EMAIL]']) {
      map['[EMAIL]'] = match;
    }
    return '[EMAIL]';
  });

  // 4. Regex Ğ´Ğ»Ñ Ğ´Ğ°Ñ‚ (Ğ´Ğ´.Ğ¼Ğ¼.Ğ³Ğ³Ğ³Ğ³, Ğ´Ğ´/Ğ¼Ğ¼/Ğ³Ğ³Ğ³Ğ³)
  const dateRegex = /\d{1,2}[\.\/]\d{1,2}[\.\/]\d{2,4}/g;
  anonymized = anonymized.replace(dateRegex, (match) => {
    const placeholder = `[DATE_${dateCounter}]`;
    map[placeholder] = match;
    dateCounter++;
    return placeholder;
  });

  // 5. Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚ (X Ğ»ĞµÑ‚, X Ğ³Ğ¾Ğ´Ğ°)
  const ageRegex = /(\d{1,3})\s*(Ğ»ĞµÑ‚|Ğ³Ğ¾Ğ´Ğ°|Ğ³Ğ¾Ğ´)/gi;
  anonymized = anonymized.replace(ageRegex, (match, age) => {
    map['[AGE]'] = age;
    return '[AGE] Ğ»ĞµÑ‚';
  });

  return { text: anonymized, map };
}

export function deanonymize(text: string, map: Record<string, string>): string {
  let result = text;

  // Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ»ÑÑ‡Ğ¸ Ğ¿Ğ¾ Ğ´Ğ»Ğ¸Ğ½Ğµ (Ğ¾Ñ‚ Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ñ… Ğº ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¼) Ğ´Ğ»Ñ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¼ĞµĞ½Ñ‹
  const sortedKeys = Object.keys(map).sort((a, b) => b.length - a.length);

  for (const placeholder of sortedKeys) {
    result = replaceAll(result, placeholder, map[placeholder]);
  }

  return result;
}

function replaceAll(str: string, search: string, replace: string): string {
  return str.split(search).join(replace);
}
```

### 5.3 Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³Ğ°

ĞœĞ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ Ğ² `sections.anonymization_map_encrypted` Ğ² Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¼ Ğ²Ğ¸Ğ´Ğµ:

```typescript
import { encrypt, decrypt } from './encryption';

// ĞŸÑ€Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğ¸
const mapJson = JSON.stringify(anonymizationResult.map);
const encryptedMap = encrypt(mapJson);
// Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ encryptedMap Ğ² sections.anonymization_map_encrypted

// ĞŸÑ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ (ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ)
const decryptedJson = decrypt(section.anonymization_map_encrypted);
const map = JSON.parse(decryptedJson);
```

---

## 6. ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Frontend

### 6.1 Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

```
src/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ SessionAnalysisPage.tsx           # Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° ÑĞµÑÑĞ¸Ğ¸
â”‚
â”œâ”€â”€ components/
â”‚   â””â”€â”€ analysis/
â”‚       â”‚
â”‚       â”œâ”€â”€ AnalysisLayout.tsx            # 2-ĞºĞ¾Ğ»Ğ¾Ğ½Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ layout
â”‚       â”‚
â”‚       â”œâ”€â”€ source-panel/                 # Ğ›ĞµĞ²Ğ°Ñ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ° â€” Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸
â”‚       â”‚   â”œâ”€â”€ SourcePanel.tsx           # ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
â”‚       â”‚   â”œâ”€â”€ SourceTabs.tsx            # Ğ’ĞºĞ»Ğ°Ğ´ĞºĞ¸ (Transcript, Notes, Files)
â”‚       â”‚   â”œâ”€â”€ TranscriptView.tsx        # ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ°
â”‚       â”‚   â”œâ”€â”€ NotesView.tsx             # ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ·Ğ°Ğ¼ĞµÑ‚Ğ¾Ğº
â”‚       â”‚   â””â”€â”€ FilesView.tsx             # Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹
â”‚       â”‚
â”‚       â”œâ”€â”€ output-panel/                 # ĞŸÑ€Ğ°Ğ²Ğ°Ñ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ° â€” Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
â”‚       â”‚   â”œâ”€â”€ OutputPanel.tsx           # ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
â”‚       â”‚   â”œâ”€â”€ TemplateSelector.tsx      # Dropdown Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ°
â”‚       â”‚   â”œâ”€â”€ SectionsList.tsx          # Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ÑĞµĞºÑ†Ğ¸Ğ¹ (drag-and-drop)
â”‚       â”‚   â”œâ”€â”€ SectionItem.tsx           # Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚ ÑĞ¿Ğ¸ÑĞºĞ° ÑĞµĞºÑ†Ğ¸Ğ¹
â”‚       â”‚   â”œâ”€â”€ SectionContent.tsx        # ĞšĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ ÑĞµĞºÑ†Ğ¸Ğ¸ (Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğ¹)
â”‚       â”‚   â”œâ”€â”€ SectionEditor.tsx         # Rich-text Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€ ÑĞµĞºÑ†Ğ¸Ğ¸
â”‚       â”‚   â””â”€â”€ AddSectionDialog.tsx      # Ğ”Ğ¸Ğ°Ğ»Ğ¾Ğ³ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑĞµĞºÑ†Ğ¸Ğ¸
â”‚       â”‚
â”‚       â”œâ”€â”€ GenerateButton.tsx            # ĞšĞ½Ğ¾Ğ¿ĞºĞ° "Generate Summary"
â”‚       â”œâ”€â”€ GenerationProgress.tsx        # Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
â”‚       â””â”€â”€ CopyButton.tsx                # ĞšĞ½Ğ¾Ğ¿ĞºĞ° ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ anonymization.ts                  # Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ°Ğ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
â”‚   â””â”€â”€ supabase-ai.ts                    # API Ğ´Ğ»Ñ AI endpoints
â”‚
â””â”€â”€ types/
    â””â”€â”€ ai.types.ts                       # Ğ¢Ğ¸Ğ¿Ñ‹ Ğ´Ğ»Ñ AI-Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»Ğ°
```

### 6.2 Ğ¢Ğ¸Ğ¿Ñ‹ (ai.types.ts)

```typescript
// src/types/ai.types.ts

export interface NoteBlockTemplate {
  id: string;
  clinic_id: string | null;
  name: string;
  name_en: string | null;
  slug: string;
  description: string | null;
  category: string;
  system_prompt: string;
  is_system: boolean;
  is_active: boolean;
  position: number;
  created_at: string;
  updated_at: string;
}

export interface ClinicalNoteTemplate {
  id: string;
  clinic_id: string | null;
  name: string;
  name_en: string | null;
  description: string | null;
  block_template_ids: string[];
  is_default: boolean;
  is_system: boolean;
  is_active: boolean;
  created_at: string;
  updated_at: string;
  // Populated
  blocks?: NoteBlockTemplate[];
}

export type GenerationStatus = 'pending' | 'generating' | 'completed' | 'failed' | 'skipped';
export type ClinicalNoteGenerationStatus = 'draft' | 'generating' | 'completed' | 'failed';

export interface GeneratedSection {
  id: string;
  clinical_note_id: string;
  block_template_id: string | null;
  name: string;
  slug: string;
  content: string | null;        // Manual content
  ai_content: string | null;     // AI-generated content
  ai_generated_at: string | null;
  generation_status: GenerationStatus;
  generation_error: string | null;
  position: number;
  // Populated
  block_template?: NoteBlockTemplate;
}

export interface GeneratedClinicalNote {
  id: string;
  session_id: string;
  patient_id: string;
  user_id: string;
  template_id: string | null;
  title: string;
  note_type: string;
  ai_summary: string | null;
  ai_generated_at: string | null;
  generation_status: ClinicalNoteGenerationStatus;
  status: 'draft' | 'in_review' | 'finalized' | 'signed';
  source_hash: string | null;
  created_at: string;
  updated_at: string;
  // Populated
  sections?: GeneratedSection[];
  template?: ClinicalNoteTemplate;
}

export interface GenerationProgress {
  clinical_note_id: string;
  status: ClinicalNoteGenerationStatus;
  progress: {
    total: number;
    completed: number;
    failed: number;
  };
  sections: Array<{
    id: string;
    name: string;
    status: GenerationStatus;
  }>;
}

export interface GenerateRequest {
  session_id: string;
  template_id: string;
  source_type: 'transcript' | 'notes' | 'combined';
}

export interface RegenerateSectionRequest {
  custom_prompt?: string;
}

export interface CaseSummaryRequest {
  patient_id: string;
}

export interface CaseSummary {
  patient_id: string;
  case_summary: string;
  generated_at: string;
  based_on_notes_count: number;
}
```

### 6.3 API ĞºĞ»Ğ¸ĞµĞ½Ñ‚ (supabase-ai.ts)

```typescript
// src/lib/supabase-ai.ts

import { supabase } from './supabase';
import type {
  NoteBlockTemplate,
  ClinicalNoteTemplate,
  GeneratedClinicalNote,
  GenerationProgress,
  GenerateRequest,
  RegenerateSectionRequest,
  CaseSummary,
} from '@/types/ai.types';

const AI_API_URL = import.meta.env.VITE_AI_API_URL || 'http://localhost:3001';

async function getAuthHeaders(): Promise<HeadersInit> {
  const { data: { session } } = await supabase.auth.getSession();
  return {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${session?.access_token}`,
  };
}

// Ğ‘Ğ»Ğ¾ĞºĞ¸ Ğ¸ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ñ‹

export async function getBlockTemplates(): Promise<NoteBlockTemplate[]> {
  const response = await fetch(`${AI_API_URL}/api/ai/block-templates`, {
    headers: await getAuthHeaders(),
  });
  const data = await response.json();
  if (!data.success) throw new Error(data.error);
  return data.data;
}

export async function getNoteTemplates(): Promise<ClinicalNoteTemplate[]> {
  const response = await fetch(`${AI_API_URL}/api/ai/note-templates`, {
    headers: await getAuthHeaders(),
  });
  const data = await response.json();
  if (!data.success) throw new Error(data.error);
  return data.data;
}

// Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ

export async function generateClinicalNote(
  request: GenerateRequest
): Promise<{ clinical_note_id: string; status: string }> {
  const response = await fetch(`${AI_API_URL}/api/ai/generate`, {
    method: 'POST',
    headers: await getAuthHeaders(),
    body: JSON.stringify(request),
  });
  const data = await response.json();
  if (!data.success) throw new Error(data.error);
  return data.data;
}

export async function getGenerationStatus(
  clinicalNoteId: string
): Promise<GenerationProgress> {
  const response = await fetch(
    `${AI_API_URL}/api/ai/generate/${clinicalNoteId}/status`,
    { headers: await getAuthHeaders() }
  );
  const data = await response.json();
  if (!data.success) throw new Error(data.error);
  return data.data;
}

export async function regenerateSection(
  sectionId: string,
  request?: RegenerateSectionRequest
): Promise<{ section_id: string; ai_content: string }> {
  const response = await fetch(
    `${AI_API_URL}/api/ai/regenerate-section/${sectionId}`,
    {
      method: 'POST',
      headers: await getAuthHeaders(),
      body: JSON.stringify(request || {}),
    }
  );
  const data = await response.json();
  if (!data.success) throw new Error(data.error);
  return data.data;
}

// Case Summary

export async function generateCaseSummary(
  patientId: string
): Promise<CaseSummary> {
  const response = await fetch(`${AI_API_URL}/api/ai/case-summary`, {
    method: 'POST',
    headers: await getAuthHeaders(),
    body: JSON.stringify({ patient_id: patientId }),
  });
  const data = await response.json();
  if (!data.success) throw new Error(data.error);
  return data.data;
}

// ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸

export async function getClinicalNote(
  clinicalNoteId: string
): Promise<GeneratedClinicalNote> {
  const { data, error } = await supabase
    .from('clinical_notes')
    .select(`
      *,
      sections (
        *,
        block_template:note_block_templates (*)
      ),
      template:clinical_note_templates (*)
    `)
    .eq('id', clinicalNoteId)
    .single();

  if (error) throw error;
  return data;
}

// ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞµĞºÑ†Ğ¸Ğ¸ (Ñ€ÑƒÑ‡Ğ½Ğ¾Ğµ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)

export async function updateSectionContent(
  sectionId: string,
  content: string
): Promise<void> {
  const { error } = await supabase
    .from('sections')
    .update({ content, updated_at: new Date().toISOString() })
    .eq('id', sectionId);

  if (error) throw error;
}

// Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸

export async function finalizeClinicalNote(
  clinicalNoteId: string
): Promise<void> {
  const { error } = await supabase
    .from('clinical_notes')
    .update({ status: 'finalized', updated_at: new Date().toISOString() })
    .eq('id', clinicalNoteId);

  if (error) throw error;
}
```

### 6.4 ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

```typescript
// src/App.tsx Ğ¸Ğ»Ğ¸ routes.tsx

import SessionAnalysisPage from '@/pages/SessionAnalysisPage';

// Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚
<Route
  path="/sessions/:sessionId/analysis"
  element={<SessionAnalysisPage />}
/>
```

### 6.5 ĞĞ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ Ğº Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ñƒ

```typescript
// Ğ’ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğµ ÑĞ¿Ğ¸ÑĞºĞ° ÑĞµÑÑĞ¸Ğ¹ Ğ¸Ğ»Ğ¸ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ ÑĞµÑÑĞ¸Ğ¸

import { useNavigate } from 'react-router-dom';

const navigate = useNavigate();

// ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ° Ğº Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ñƒ
<Button
  onClick={() => navigate(`/sessions/${session.id}/analysis`)}
  disabled={!session.patient_id} // ĞĞµĞ»ÑŒĞ·Ñ Ğ±ĞµĞ· Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ°
>
  <Sparkles className="w-4 h-4 mr-2" />
  AI ĞĞ½Ğ°Ğ»Ğ¸Ğ·
</Button>
```

---

## 7. Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¾Ğ¹ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ°

### 7.1 CaseSummaryBlock Ğ² PatientInfoTab

```typescript
// src/components/patients/CaseSummaryBlock.tsx

import { useState } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { Button } from '@/components/ui/button';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import { Loader2, RefreshCw, Sparkles } from 'lucide-react';
import { generateCaseSummary } from '@/lib/supabase-ai';

interface CaseSummaryBlockProps {
  patientId: string;
  caseSummary: string | null;
  generatedAt: string | null;
}

export function CaseSummaryBlock({
  patientId,
  caseSummary,
  generatedAt
}: CaseSummaryBlockProps) {
  const queryClient = useQueryClient();

  const generateMutation = useMutation({
    mutationFn: () => generateCaseSummary(patientId),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['patient', patientId] });
    },
  });

  return (
    <Card>
      <CardHeader className="flex flex-row items-center justify-between">
        <CardTitle className="text-lg flex items-center gap-2">
          <Sparkles className="w-5 h-5" />
          Ğ¡Ğ²Ğ¾Ğ´ĞºĞ° Ğ¿Ğ¾ ÑĞ»ÑƒÑ‡Ğ°Ñ
        </CardTitle>
        <Button
          variant="outline"
          size="sm"
          onClick={() => generateMutation.mutate()}
          disabled={generateMutation.isPending}
        >
          {generateMutation.isPending ? (
            <Loader2 className="w-4 h-4 animate-spin" />
          ) : (
            <RefreshCw className="w-4 h-4" />
          )}
          {caseSummary ? 'ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ' : 'Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ'}
        </Button>
      </CardHeader>
      <CardContent>
        {caseSummary ? (
          <>
            <p className="text-sm text-muted-foreground mb-2">
              ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾: {new Date(generatedAt!).toLocaleDateString('ru-RU')}
            </p>
            <p className="whitespace-pre-wrap">{caseSummary}</p>
          </>
        ) : (
          <p className="text-muted-foreground">
            Ğ¡Ğ²Ğ¾Ğ´ĞºĞ° ĞµÑ‰Ñ‘ Ğ½Ğµ ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°. ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ "Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ" Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ
            AI-Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ²ÑĞµÑ… ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ·Ğ°Ğ¼ĞµÑ‚Ğ¾Ğº Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ°.
          </p>
        )}
      </CardContent>
    </Card>
  );
}
```

### 7.2 Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ Ğ² PatientActivitiesTab

```typescript
// ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ SessionActivityItem Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ ÑĞ°Ğ¼Ğ¼Ğ°Ñ€Ğ¸

interface SessionActivityItemProps {
  session: Session;
  clinicalNote?: ClinicalNote;
}

export function SessionActivityItem({ session, clinicalNote }: SessionActivityItemProps) {
  const [expanded, setExpanded] = useState(false);

  return (
    <div className="border rounded-lg p-4">
      <div className="flex justify-between items-start">
        <div>
          <h4 className="font-medium">{session.title}</h4>
          <p className="text-sm text-muted-foreground">
            {formatDate(session.started_at)} â€¢ {session.duration_seconds} Ğ¼Ğ¸Ğ½
          </p>
        </div>
        {clinicalNote && (
          <Badge variant={clinicalNote.status === 'finalized' ? 'default' : 'secondary'}>
            {clinicalNote.status === 'finalized' ? 'Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ° Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ°' : 'Ğ§ĞµÑ€Ğ½Ğ¾Ğ²Ğ¸Ğº'}
          </Badge>
        )}
      </div>

      {/* ĞšÑ€Ğ°Ñ‚ĞºĞ¾Ğµ ÑĞ°Ğ¼Ğ¼Ğ°Ñ€Ğ¸ */}
      {clinicalNote?.ai_summary && (
        <p className="mt-2 text-sm line-clamp-2">
          {clinicalNote.ai_summary}
        </p>
      )}

      {/* ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ñ€Ğ°Ğ·Ğ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ */}
      {clinicalNote && (
        <Button
          variant="ghost"
          size="sm"
          className="mt-2"
          onClick={() => setExpanded(!expanded)}
        >
          {expanded ? 'Ğ¡Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ' : 'ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ½ÑƒÑ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºÑƒ'}
        </Button>
      )}

      {/* ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ° */}
      {expanded && clinicalNote && (
        <ClinicalNoteView clinicalNote={clinicalNote} />
      )}
    </div>
  );
}
```

---

## 8. Backend Implementation

### 8.1 Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

```
backend/transcription-service/
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ transcribe.js      # Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹
â”‚   â”œâ”€â”€ webhook.js         # Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹
â”‚   â””â”€â”€ ai.js              # ĞĞĞ’Ğ«Ğ™ â€” AI endpoints
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ openai.js          # ĞĞĞ’Ğ«Ğ™ â€” OpenAI client
â”‚   â”œâ”€â”€ anonymization.js   # ĞĞĞ’Ğ«Ğ™ â€” ĞĞ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
â”‚   â””â”€â”€ encryption.js      # ĞĞĞ’Ğ«Ğ™ â€” Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (Ğ¸Ğ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ)
â”‚
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ auth.js            # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° JWT Ñ‚Ğ¾ĞºĞµĞ½Ğ°
â”‚
â””â”€â”€ server.js              # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ route Ğ´Ğ»Ñ /api/ai
```

### 8.2 OpenAI Service

```javascript
// backend/transcription-service/services/openai.js

const OpenAI = require('openai');

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

/**
 * Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ° Ğ´Ğ»Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ°
 */
async function generateBlockContent(systemPrompt, transcript) {
  const completion = await openai.chat.completions.create({
    model: 'gpt-5', // Ğ¸Ğ»Ğ¸ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ
    messages: [
      {
        role: 'system',
        content: systemPrompt,
      },
      {
        role: 'user',
        content: `Ğ’Ğ¾Ñ‚ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ñ‚ĞµÑ€Ğ°Ğ¿ĞµĞ²Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ ÑĞµÑÑĞ¸Ğ¸:\n\n${transcript}`,
      },
    ],
    temperature: 0.3, // ĞĞ¸Ğ·ĞºĞ°Ñ Ğ´Ğ»Ñ ĞºĞ¾Ğ½ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚Ğ¸
    max_tokens: 1000,
  });

  return completion.choices[0].message.content;
}

/**
 * Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑĞ²Ğ¾Ğ´ĞºĞ¸ Ğ¿Ğ¾ ÑĞ»ÑƒÑ‡Ğ°Ñ
 */
async function generateCaseSummaryContent(clinicalNotesText) {
  const completion = await openai.chat.completions.create({
    model: 'gpt-5',
    messages: [
      {
        role: 'system',
        content: `Ğ¢Ñ‹ â€” Ğ¾Ğ¿Ñ‹Ñ‚Ğ½Ñ‹Ğ¹ Ğ¿ÑĞ¸Ñ…Ğ¸Ğ°Ñ‚Ñ€. ĞĞ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ñ… ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ·Ğ°Ğ¼ĞµÑ‚Ğ¾Ğº
ÑĞ¾Ğ·Ğ´Ğ°Ğ¹ ĞºÑ€Ğ°Ñ‚ĞºÑƒÑ ÑĞ²Ğ¾Ğ´ĞºÑƒ Ğ¿Ğ¾ ÑĞ»ÑƒÑ‡Ğ°Ñ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ°.

Ğ’ĞºĞ»ÑÑ‡Ğ¸:
1. ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾Ğ· / Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ²Ğ¿ĞµÑ‡Ğ°Ñ‚Ğ»ĞµĞ½Ğ¸Ğµ
2. ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ¸Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼Ñ‹ Ğ¸ Ğ¸Ñ… Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸ĞºĞ°
3. Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ¸ ĞµĞ³Ğ¾ ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ
4. ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ€Ğ¸ÑĞºĞ¸
5. ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ· Ğ¸ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸

ĞŸĞ¸ÑˆĞ¸ ĞºÑ€Ğ°Ñ‚ĞºĞ¾ (3-5 Ğ°Ğ±Ğ·Ğ°Ñ†ĞµĞ²), Ğ¿Ñ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾, Ğ¾Ñ‚ Ñ‚Ñ€ĞµÑ‚ÑŒĞµĞ³Ğ¾ Ğ»Ğ¸Ñ†Ğ°.`,
      },
      {
        role: 'user',
        content: `ĞšĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ°:\n\n${clinicalNotesText}`,
      },
    ],
    temperature: 0.3,
    max_tokens: 1500,
  });

  return completion.choices[0].message.content;
}

module.exports = {
  generateBlockContent,
  generateCaseSummaryContent,
};
```

### 8.3 AI Routes

```javascript
// backend/transcription-service/routes/ai.js

const express = require('express');
const router = express.Router();
const { createClient } = require('@supabase/supabase-js');
const { generateBlockContent, generateCaseSummaryContent } = require('../services/openai');
const { anonymize, deanonymize } = require('../services/anonymization');
const { encrypt, decrypt } = require('../services/encryption');
const crypto = require('crypto');

const supabase = createClient(
  process.env.SUPABASE_URL,
  process.env.SUPABASE_SERVICE_KEY
);

/**
 * GET /api/ai/block-templates
 * ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ğ±Ğ»Ğ¾ĞºĞ¾Ğ²
 */
router.get('/block-templates', async (req, res) => {
  try {
    const { clinic_id } = req.user;

    const { data, error } = await supabase
      .from('note_block_templates')
      .select('*')
      .or(`clinic_id.eq.${clinic_id},is_system.eq.true`)
      .eq('is_active', true)
      .order('position');

    if (error) throw error;

    res.json({ success: true, data });
  } catch (error) {
    console.error('Error fetching block templates:', error);
    res.status(500).json({ success: false, error: error.message });
  }
});

/**
 * GET /api/ai/note-templates
 * ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ² Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ¾Ğ² Ğ±Ğ»Ğ¾ĞºĞ¾Ğ²
 */
router.get('/note-templates', async (req, res) => {
  try {
    const { clinic_id } = req.user;

    const { data: templates, error } = await supabase
      .from('clinical_note_templates')
      .select('*')
      .or(`clinic_id.eq.${clinic_id},is_system.eq.true`)
      .eq('is_active', true);

    if (error) throw error;

    // Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ±Ğ»Ğ¾ĞºĞ¸ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ°
    const { data: blocks } = await supabase
      .from('note_block_templates')
      .select('*')
      .or(`clinic_id.eq.${clinic_id},is_system.eq.true`)
      .eq('is_active', true);

    const templatesWithBlocks = templates.map(template => ({
      ...template,
      blocks: template.block_template_ids
        .map(id => blocks.find(b => b.id === id))
        .filter(Boolean),
    }));

    res.json({ success: true, data: templatesWithBlocks });
  } catch (error) {
    console.error('Error fetching note templates:', error);
    res.status(500).json({ success: false, error: error.message });
  }
});

/**
 * POST /api/ai/generate
 * Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸
 */
router.post('/generate', async (req, res) => {
  try {
    const { session_id, template_id, source_type } = req.body;
    const { id: user_id, clinic_id } = req.user;

    // 1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞµÑÑĞ¸Ñ
    const { data: session, error: sessionError } = await supabase
      .from('sessions')
      .select('*, patient:patients(*)')
      .eq('id', session_id)
      .single();

    if (sessionError) throw sessionError;

    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ²ÑĞ·ĞºÑƒ Ğº Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ñƒ
    if (!session.patient_id) {
      return res.status(400).json({
        success: false,
        error: 'Ğ¡ĞµÑÑĞ¸Ñ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ğ°Ğ½Ğ° Ğº Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ñƒ Ğ´Ğ»Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ·Ğ°Ğ¼ĞµÑ‚Ğ¾Ğº',
      });
    }

    // 2. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½
    const { data: template, error: templateError } = await supabase
      .from('clinical_note_templates')
      .select('*')
      .eq('id', template_id)
      .single();

    if (templateError) throw templateError;

    // 3. Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚
    let sourceText = '';

    if (source_type === 'transcript' || source_type === 'combined') {
      const { data: recordings } = await supabase
        .from('recordings')
        .select('transcription_text')
        .eq('session_id', session_id)
        .eq('transcription_status', 'completed');

      if (recordings?.length) {
        const transcripts = recordings
          .map(r => decrypt(r.transcription_text))
          .join('\n\n');
        sourceText += transcripts;
      }
    }

    if (source_type === 'notes' || source_type === 'combined') {
      const { data: notes } = await supabase
        .from('session_notes')
        .select('content')
        .eq('session_id', session_id);

      if (notes?.length) {
        sourceText += '\n\n' + notes.map(n => n.content).join('\n\n');
      }
    }

    if (!sourceText.trim()) {
      return res.status(400).json({
        success: false,
        error: 'ĞĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°. Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ¸Ğ»Ğ¸ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸.',
      });
    }

    // 4. ĞĞ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼
    const { text: anonymizedText, map: anonymizationMap } = anonymize(
      sourceText,
      session.patient
    );

    // 5. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ clinical_note
    const sourceHash = crypto.createHash('sha256').update(sourceText).digest('hex');

    const { data: clinicalNote, error: noteError } = await supabase
      .from('clinical_notes')
      .insert({
        session_id,
        patient_id: session.patient_id,
        user_id,
        template_id,
        title: template.name,
        note_type: 'initial_assessment',
        generation_status: 'generating',
        source_hash: sourceHash,
        status: 'draft',
      })
      .select()
      .single();

    if (noteError) throw noteError;

    // 6. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ±Ğ»Ğ¾ĞºĞ¸ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ°
    const { data: blockTemplates } = await supabase
      .from('note_block_templates')
      .select('*')
      .in('id', template.block_template_ids);

    // Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ Ğ¿Ğ¾Ñ€ÑĞ´ĞºÑƒ Ğ² ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğµ
    const orderedBlocks = template.block_template_ids
      .map(id => blockTemplates.find(b => b.id === id))
      .filter(Boolean);

    // 7. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ sections
    const sectionsToInsert = orderedBlocks.map((block, index) => ({
      clinical_note_id: clinicalNote.id,
      block_template_id: block.id,
      name: block.name,
      slug: block.slug,
      position: index,
      generation_status: 'pending',
      anonymization_map_encrypted: encrypt(JSON.stringify(anonymizationMap)),
    }));

    const { data: sections, error: sectionsError } = await supabase
      .from('sections')
      .insert(sectionsToInsert)
      .select();

    if (sectionsError) throw sectionsError;

    // 8. Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½ÑƒÑ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ (Ğ² Ñ„Ğ¾Ğ½Ğµ)
    generateSectionsInBackground(
      clinicalNote.id,
      sections,
      orderedBlocks,
      anonymizedText,
      anonymizationMap,
      user_id
    );

    // 9. Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼
    await supabase.from('audit_logs').insert({
      user_id,
      action: 'ai_generation_started',
      resource_type: 'clinical_note',
      resource_id: clinicalNote.id,
      details: {
        session_id,
        template_id,
        source_type,
        sections_count: sections.length,
      },
    });

    res.json({
      success: true,
      data: {
        clinical_note_id: clinicalNote.id,
        status: 'generating',
        sections_count: sections.length,
      },
    });
  } catch (error) {
    console.error('Error starting generation:', error);
    res.status(500).json({ success: false, error: error.message });
  }
});

/**
 * Ğ¤Ğ¾Ğ½Ğ¾Ğ²Ğ°Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑĞµĞºÑ†Ğ¸Ğ¹
 */
async function generateSectionsInBackground(
  clinicalNoteId,
  sections,
  blockTemplates,
  anonymizedText,
  anonymizationMap,
  userId
) {
  try {
    // ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ²ÑĞµÑ… ÑĞµĞºÑ†Ğ¸Ğ¹
    const results = await Promise.allSettled(
      sections.map(async (section, index) => {
        const block = blockTemplates[index];

        try {
          // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ½Ğ° "generating"
          await supabase
            .from('sections')
            .update({ generation_status: 'generating' })
            .eq('id', section.id);

          // Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚
          const aiContent = await generateBlockContent(
            block.system_prompt,
            anonymizedText
          );

          // Ğ”Ğµ-Ğ°Ğ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼
          const deanonymizedContent = deanonymize(aiContent, anonymizationMap);

          // Ğ¨Ğ¸Ñ„Ñ€ÑƒĞµĞ¼ Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼
          const encryptedContent = encrypt(deanonymizedContent);

          await supabase
            .from('sections')
            .update({
              ai_content: encryptedContent,
              ai_generated_at: new Date().toISOString(),
              generation_status: 'completed',
            })
            .eq('id', section.id);

          return { section_id: section.id, status: 'completed' };
        } catch (error) {
          await supabase
            .from('sections')
            .update({
              generation_status: 'failed',
              generation_error: error.message,
            })
            .eq('id', section.id);

          return { section_id: section.id, status: 'failed', error: error.message };
        }
      })
    );

    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
    const failedCount = results.filter(
      r => r.status === 'rejected' || r.value?.status === 'failed'
    ).length;

    const finalStatus = failedCount === sections.length ? 'failed' : 'completed';

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ clinical_note
    await supabase
      .from('clinical_notes')
      .update({ generation_status: finalStatus })
      .eq('id', clinicalNoteId);

    // Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğµ
    await supabase.from('audit_logs').insert({
      user_id: userId,
      action: 'ai_generation_completed',
      resource_type: 'clinical_note',
      resource_id: clinicalNoteId,
      details: {
        status: finalStatus,
        completed: sections.length - failedCount,
        failed: failedCount,
      },
    });
  } catch (error) {
    console.error('Background generation error:', error);

    await supabase
      .from('clinical_notes')
      .update({ generation_status: 'failed' })
      .eq('id', clinicalNoteId);
  }
}

/**
 * GET /api/ai/generate/:clinicalNoteId/status
 * ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
 */
router.get('/generate/:clinicalNoteId/status', async (req, res) => {
  try {
    const { clinicalNoteId } = req.params;

    const { data: clinicalNote, error } = await supabase
      .from('clinical_notes')
      .select(`
        id,
        generation_status,
        sections (
          id,
          name,
          generation_status
        )
      `)
      .eq('id', clinicalNoteId)
      .single();

    if (error) throw error;

    const sections = clinicalNote.sections || [];
    const completed = sections.filter(s => s.generation_status === 'completed').length;
    const failed = sections.filter(s => s.generation_status === 'failed').length;

    res.json({
      success: true,
      data: {
        clinical_note_id: clinicalNote.id,
        status: clinicalNote.generation_status,
        progress: {
          total: sections.length,
          completed,
          failed,
        },
        sections: sections.map(s => ({
          id: s.id,
          name: s.name,
          status: s.generation_status,
        })),
      },
    });
  } catch (error) {
    console.error('Error fetching generation status:', error);
    res.status(500).json({ success: false, error: error.message });
  }
});

/**
 * POST /api/ai/regenerate-section/:sectionId
 * ĞŸĞµÑ€ĞµĞ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ°
 */
router.post('/regenerate-section/:sectionId', async (req, res) => {
  try {
    const { sectionId } = req.params;
    const { custom_prompt } = req.body;
    const { id: user_id } = req.user;

    // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞµĞºÑ†Ğ¸Ñ Ñ Ğ±Ğ»Ğ¾ĞºĞ¾Ğ¼ Ğ¸ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¾Ğ¹
    const { data: section, error } = await supabase
      .from('sections')
      .select(`
        *,
        block_template:note_block_templates (*),
        clinical_note:clinical_notes (
          *,
          session:sessions (
            *,
            patient:patients (*)
          )
        )
      `)
      .eq('id', sectionId)
      .single();

    if (error) throw error;

    // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚
    const { data: recordings } = await supabase
      .from('recordings')
      .select('transcription_text')
      .eq('session_id', section.clinical_note.session_id)
      .eq('transcription_status', 'completed');

    let sourceText = recordings
      ?.map(r => decrypt(r.transcription_text))
      .join('\n\n') || '';

    // ĞĞ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼
    const { text: anonymizedText, map: anonymizationMap } = anonymize(
      sourceText,
      section.clinical_note.session.patient
    );

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ‚ÑƒÑ
    await supabase
      .from('sections')
      .update({ generation_status: 'generating' })
      .eq('id', sectionId);

    // Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼
    const prompt = custom_prompt || section.block_template.system_prompt;
    const aiContent = await generateBlockContent(prompt, anonymizedText);

    // Ğ”Ğµ-Ğ°Ğ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¸ ÑˆĞ¸Ñ„Ñ€ÑƒĞµĞ¼
    const deanonymizedContent = deanonymize(aiContent, anonymizationMap);
    const encryptedContent = encrypt(deanonymizedContent);

    // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼
    await supabase
      .from('sections')
      .update({
        ai_content: encryptedContent,
        ai_generated_at: new Date().toISOString(),
        generation_status: 'completed',
        generation_error: null,
        anonymization_map_encrypted: encrypt(JSON.stringify(anonymizationMap)),
      })
      .eq('id', sectionId);

    // Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼
    await supabase.from('audit_logs').insert({
      user_id,
      action: 'ai_section_regenerated',
      resource_type: 'section',
      resource_id: sectionId,
      details: { custom_prompt: !!custom_prompt },
    });

    res.json({
      success: true,
      data: {
        section_id: sectionId,
        status: 'completed',
        ai_content: deanonymizedContent, // Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ñ€Ğ°ÑÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹
      },
    });
  } catch (error) {
    console.error('Error regenerating section:', error);
    res.status(500).json({ success: false, error: error.message });
  }
});

/**
 * POST /api/ai/case-summary
 * Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑĞ²Ğ¾Ğ´ĞºĞ¸ Ğ¿Ğ¾ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ñƒ
 */
router.post('/case-summary', async (req, res) => {
  try {
    const { patient_id } = req.body;
    const { id: user_id } = req.user;

    // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ°
    const { data: patient, error: patientError } = await supabase
      .from('patients')
      .select('*')
      .eq('id', patient_id)
      .single();

    if (patientError) throw patientError;

    // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ²ÑĞµ ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ°
    const { data: clinicalNotes, error: notesError } = await supabase
      .from('clinical_notes')
      .select('*, sections (*)')
      .eq('patient_id', patient_id)
      .in('status', ['finalized', 'completed'])
      .order('created_at', { ascending: true });

    if (notesError) throw notesError;

    if (!clinicalNotes?.length) {
      return res.status(400).json({
        success: false,
        error: 'ĞĞµÑ‚ Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½Ğ½Ñ‹Ñ… ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ·Ğ°Ğ¼ĞµÑ‚Ğ¾Ğº Ğ´Ğ»Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ ÑĞ²Ğ¾Ğ´ĞºĞ¸',
      });
    }

    // Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ñ‚ĞµĞºÑÑ‚ Ğ¸Ğ· Ğ²ÑĞµÑ… Ğ·Ğ°Ğ¼ĞµÑ‚Ğ¾Ğº
    let combinedText = '';
    for (const note of clinicalNotes) {
      combinedText += `\n\n=== Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ° Ğ¾Ñ‚ ${note.created_at} ===\n`;
      for (const section of note.sections || []) {
        if (section.ai_content) {
          combinedText += `\n### ${section.name}\n`;
          combinedText += decrypt(section.ai_content);
        }
      }
    }

    // ĞĞ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼
    const { text: anonymizedText, map: anonymizationMap } = anonymize(
      combinedText,
      patient
    );

    // Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ²Ğ¾Ğ´ĞºÑƒ
    const aiSummary = await generateCaseSummaryContent(anonymizedText);

    // Ğ”Ğµ-Ğ°Ğ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼
    const deanonymizedSummary = deanonymize(aiSummary, anonymizationMap);

    // Ğ¨Ğ¸Ñ„Ñ€ÑƒĞµĞ¼ Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼
    const encryptedSummary = encrypt(deanonymizedSummary);

    await supabase
      .from('patients')
      .update({
        case_summary_encrypted: encryptedSummary,
        case_summary_generated_at: new Date().toISOString(),
      })
      .eq('id', patient_id);

    // Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼
    await supabase.from('audit_logs').insert({
      user_id,
      action: 'ai_case_summary_generated',
      resource_type: 'patient',
      resource_id: patient_id,
      details: { based_on_notes_count: clinicalNotes.length },
    });

    res.json({
      success: true,
      data: {
        patient_id,
        case_summary: deanonymizedSummary,
        generated_at: new Date().toISOString(),
        based_on_notes_count: clinicalNotes.length,
      },
    });
  } catch (error) {
    console.error('Error generating case summary:', error);
    res.status(500).json({ success: false, error: error.message });
  }
});

module.exports = router;
```

### 8.4 ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ routes Ğ² server.js

```javascript
// backend/transcription-service/server.js

const aiRoutes = require('./routes/ai');

// ... ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ ĞºĞ¾Ğ´ ...

// ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ AI routes
app.use('/api/ai', authMiddleware, aiRoutes);
```

---

## 9. Environment Variables

### 9.1 Backend (.env)

```env
# Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_SERVICE_KEY=eyJ...
ASSEMBLYAI_API_KEY=asm_...

# ĞĞ¾Ğ²Ñ‹Ğµ Ğ´Ğ»Ñ AI
OPENAI_API_KEY=sk-...
ENCRYPTION_KEY=<base64-encoded-32-byte-key>
```

### 9.2 Frontend (.env)

```env
# Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ
VITE_SUPABASE_URL=https://xxx.supabase.co
VITE_SUPABASE_ANON_KEY=eyJ...

# AI API URL (Ñ‚Ğ¾Ñ‚ Ğ¶Ğµ ÑĞµÑ€Ğ²ĞµÑ€)
VITE_AI_API_URL=http://localhost:3001
```

---

## 10. ĞŸĞ»Ğ°Ğ½ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### Ğ­Ñ‚Ğ°Ğ¿ 1: Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸ Backend (5-7 Ğ´Ğ½ĞµĞ¹)

- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†
- [ ] Seed ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… Ğ±Ğ»Ğ¾ĞºĞ¾Ğ² Ğ¸ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ²
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞµÑ€Ğ²Ğ¸Ñ Ğ°Ğ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ OpenAI ÑĞµÑ€Ğ²Ğ¸Ñ
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ AI routes
- [ ] ĞĞ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ñ‚ĞµÑÑ‚Ñ‹ Ğ´Ğ»Ñ API

### Ğ­Ñ‚Ğ°Ğ¿ 2: Frontend â€” Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° (7-10 Ğ´Ğ½ĞµĞ¹)

- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ SessionAnalysisPage
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ SourcePanel (Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚, Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸)
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ OutputPanel (ÑĞµĞºÑ†Ğ¸Ğ¸, Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€)
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ TemplateSelector
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ GenerateButton Ğ¸ GenerationProgress
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞµĞºÑ†Ğ¸Ğ¹
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

### Ğ­Ñ‚Ğ°Ğ¿ 3: Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ¼ (3-5 Ğ´Ğ½ĞµĞ¹)

- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ CaseSummaryBlock Ğ² PatientInfoTab
- [ ] ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ PatientActivitiesTab Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ¼ĞµÑ‚Ğ¾Ğº
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸

### Ğ­Ñ‚Ğ°Ğ¿ 4: ĞŸĞ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ¸ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (3-5 Ğ´Ğ½ĞµĞ¹)

- [ ] Drag-and-drop Ğ´Ğ»Ñ ÑĞµĞºÑ†Ğ¸Ğ¹
- [ ] ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² Ğ±ÑƒÑ„ĞµÑ€ Ğ¾Ğ±Ğ¼ĞµĞ½Ğ°
- [ ] ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ¸ edge cases
- [ ] UI/UX polish
- [ ] Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ğ¾Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
- [ ] Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹

---

## 11. Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

### 11.1 Checklist

- [ ] Ğ’ÑĞµ AI-generated ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ ÑˆĞ¸Ñ„Ñ€ÑƒĞµÑ‚ÑÑ AES-GCM 256
- [ ] ĞĞ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ Ğ¿ĞµÑ€ĞµĞ´ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ğ¹ Ğ² OpenAI
- [ ] ĞœĞ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ Ğ°Ğ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¼
- [ ] Ğ’ÑĞµ AI-Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒÑÑ‚ÑÑ Ğ² audit_logs
- [ ] RLS policies Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑÑÑ‚ÑÑ Ğº Ğ½Ğ¾Ğ²Ñ‹Ğ¼ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ğ¼
- [ ] Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰ĞµĞ½Ğ° Ğ±ĞµĞ· Ğ¿Ñ€Ğ¸Ğ²ÑĞ·ĞºĞ¸ Ğº Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ñƒ
- [ ] JWT Ñ‚Ğ¾ĞºĞµĞ½ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ÑÑ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… AI endpoints

### 11.2 HIPAA Compliance

- PHI Ğ½Ğµ Ğ¿Ğ¾ĞºĞ¸Ğ´Ğ°ĞµÑ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ğ² Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¾Ğ¼ Ğ²Ğ¸Ğ´Ğµ
- ĞĞ½Ğ¾Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑĞ½Ğ¸Ğ¶Ğ°ĞµÑ‚ Ñ€Ğ¸ÑĞº ÑƒÑ‚ĞµÑ‡ĞºĞ¸ Ñ‡ĞµÑ€ĞµĞ· OpenAI
- Audit trail Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹ Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ²
- Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ at rest Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

---

## 12. ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸

### 12.1 Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

Ğ’ÑĞµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ÑÑ‚ÑÑ Ğ² `audit_logs`:

| action | description |
|--------|-------------|
| `ai_generation_started` | ĞĞ°Ñ‡Ğ°Ñ‚Ğ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ |
| `ai_generation_completed` | Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ° |
| `ai_section_regenerated` | ĞŸĞµÑ€ĞµĞ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑĞµĞºÑ†Ğ¸Ğ¸ |
| `ai_case_summary_generated` | Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° ÑĞ²Ğ¾Ğ´ĞºĞ° Ğ¿Ğ¾ ÑĞ»ÑƒÑ‡Ğ°Ñ |

### 12.2 ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ

- Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
- ĞŸÑ€Ğ¾Ñ†ĞµĞ½Ñ‚ ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ñ… Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹
- ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿ĞµÑ€ĞµĞ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ API (Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ OpenAI)

---

## 13. Ğ˜Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğµ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ

1. **GPT-5 availability** â€” ĞµÑĞ»Ğ¸ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°, ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° gracefully fallback Ğ½Ğ° gpt-4o
2. **Rate limits OpenAI** â€” Ğ¿Ñ€Ğ¸ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ 11 Ğ±Ğ»Ğ¾ĞºĞ¾Ğ² Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹ rate limits
3. **Ğ”Ğ»Ğ¸Ğ½Ğ° Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ°** â€” Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ğµ Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ñ‹ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞ°Ñ‚ÑŒ context window

### 13.1 Mitigation strategies

- Retry Ñ exponential backoff Ğ´Ğ»Ñ rate limits
- Chunking Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ñ… Ñ‚Ñ€Ğ°Ğ½ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ²
- Queue ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ´Ğ»Ñ Ğ²Ñ‹ÑĞ¾ĞºĞ¾Ğ¹ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾, Ğ´Ğ»Ñ Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ³Ğ¾)

---

## 14. Ğ“Ğ»Ğ¾ÑÑĞ°Ñ€Ğ¸Ğ¹

| Ğ¢ĞµÑ€Ğ¼Ğ¸Ğ½ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|--------|----------|
| Block Template | Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ° Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğ¼ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼ |
| Clinical Note Template | ĞĞ°Ğ±Ğ¾Ñ€ Ğ±Ğ»Ğ¾ĞºĞ¾Ğ² Ğ´Ğ»Ñ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ñ‘Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° Ğ¾Ñ†ĞµĞ½ĞºĞ¸ |
| Section | Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ±Ğ»Ğ¾Ğº Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ |
| Clinical Note | ĞŸĞ¾Ğ»Ğ½Ğ°Ñ ĞºĞ»Ğ¸Ğ½Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ°, ÑĞ¾ÑÑ‚Ğ¾ÑÑ‰Ğ°Ñ Ğ¸Ğ· ÑĞµĞºÑ†Ğ¸Ğ¹ |
| Case Summary | AI-ÑĞ²Ğ¾Ğ´ĞºĞ° Ğ¿Ğ¾ Ğ²ÑĞµĞ¹ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ¿Ğ°Ñ†Ğ¸ĞµĞ½Ñ‚Ğ° |
| Anonymization | Ğ—Ğ°Ğ¼ĞµĞ½Ğ° PHI Ğ½Ğ° Ğ¿Ğ»ĞµĞ¹ÑÑ…Ğ¾Ğ»Ğ´ĞµÑ€Ñ‹ Ğ¿ĞµÑ€ĞµĞ´ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ğ¹ Ğ² AI |
| PHI | Protected Health Information (HIPAA Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½) |

---

## 15. ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ‹

**Ğ’Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¿Ğ¾ Ğ¢Ğ—:** [ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚]
**Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°:** [ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚]

---

*Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ½: 2025-12-08*
*ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: 2025-12-08*
